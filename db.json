{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/rating.js","path":"js/third-party/rating.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"ece6ac05f132955736470e4033c10926dc3e65fe","modified":1483506690000},{"_id":"source/_posts/build-imagemagick-libwebp-with-jpeg-turbo-from-source.md","hash":"4df808a32431ccd88b3b5e6a69202fb5feb0c8a4","modified":1650196026901},{"_id":"source/about/index.md","hash":"db67849990070545157595e6259b3016545ac4b1","modified":1650195649362},{"_id":"source/tags/index.md","hash":"e3d067c486a9abc9ee53ea541add6c49afbdea9f","modified":1650195649366},{"_id":"source/.DS_Store","hash":"73507182be0abed58b753aa12643c614d2efb238","modified":1621181675023},{"_id":"source/_posts/nginx-http2-grpc.md","hash":"078fb4e2ecc71a538071113eb7d8f31c41035135","modified":1650196311399},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1649516914320},{"_id":"themes/next/.eslintrc.json","hash":"9c0762486f24a8c5e60f8b6c875e4c4728942649","modified":1649516914320},{"_id":"themes/next/.gitattributes","hash":"ec43734985e1cafd53d88ded3020103f7416123c","modified":1649516914320},{"_id":"themes/next/.gitignore","hash":"417520c4dbbeab9c7e3ab10d944da0886366a0ee","modified":1649516914330},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1649516914331},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1649516914332},{"_id":"themes/next/README.md","hash":"c8fab0d6caf50be68662a4f9b86b87bde3ae354b","modified":1649516914333},{"_id":"themes/next/_vendors.yml","hash":"cf97b8bcd78e6f8b6d22e470528ad2c27156c95d","modified":1649516914336},{"_id":"themes/next/package.json","hash":"ae1de55975868db5984b565991dfe3caa3f8cf01","modified":1649516914379},{"_id":"themes/next/_config.yml","hash":"cb48d885a2509e765c727f10dcabd9b4342a891a","modified":1649520261315},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1649516914337},{"_id":"themes/next/.githooks/install.js","hash":"4d77dbddf2eac1f3fc78f151d12ed22208ed655b","modified":1649516914321},{"_id":"themes/next/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1649516914380},{"_id":"themes/next/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1649516914321},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"21cbff565a0445d3a880fff1ee417e309740a9ab","modified":1649516914322},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1649516914322},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"3e9fbb78e3dee0ca1dc886d0c28b0148ba0ca499","modified":1649516914325},{"_id":"themes/next/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1649516914325},{"_id":"themes/next/.github/label-commenter-config.yml","hash":"1097fc47beeacfc1edb0248c27b17bf64bde3565","modified":1649516914326},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1649516914325},{"_id":"themes/next/.github/labeler.yml","hash":"5c4bc2bd561e6d9b33ee118cc12218c5de46f72d","modified":1649516914326},{"_id":"themes/next/.github/release-drafter.yml","hash":"423275ec021104b263cd88776936a8c8d6872b66","modified":1649516914327},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1649516914340},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1649516914339},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1649516914340},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1649516914343},{"_id":"themes/next/languages/ar.yml","hash":"bca66db21c015dbd32970d8708b898518a773e1e","modified":1649516914343},{"_id":"themes/next/languages/de.yml","hash":"4be7b8b76c81bf1853eb36d2e874b17546a0e792","modified":1649516914344},{"_id":"themes/next/languages/bn.yml","hash":"b5e2a35eb6fff56b6e32ce479e63b6fc5e44d5cb","modified":1649516914343},{"_id":"themes/next/languages/default.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1649516914344},{"_id":"themes/next/languages/en.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1649516914344},{"_id":"themes/next/languages/es.yml","hash":"b813da5aed9d73b809133db4dfb08f90ec56afd9","modified":1649516914344},{"_id":"themes/next/languages/fa.yml","hash":"6456d40dd42f44101d9d6e7054e9884e9163f948","modified":1649516914345},{"_id":"themes/next/languages/fr.yml","hash":"b15dc05afdc94de02e5d3fee4f8d3dc5594dd37e","modified":1649516914345},{"_id":"themes/next/languages/id.yml","hash":"14e794db4eca36b257994d81eb513e61d1edcbd6","modified":1649516914345},{"_id":"themes/next/languages/it.yml","hash":"c1eeab4992c76bfd436bb205ce58b1cfeef55ee6","modified":1649516914345},{"_id":"themes/next/languages/ja.yml","hash":"d48c4157e0e02e847aac7b513580d3364c81948c","modified":1649516914345},{"_id":"themes/next/languages/ko.yml","hash":"819c19eb9d142e5411f77cf3821d90f740ee114a","modified":1649516914346},{"_id":"themes/next/languages/nl.yml","hash":"ecb8e39c6225f3c068a5fdd569ee7dafd5c41a1f","modified":1649516914346},{"_id":"themes/next/languages/pt-BR.yml","hash":"a1f27b3a592fc58f17d247f5563ff4a90a3da5f2","modified":1649516914346},{"_id":"themes/next/languages/pt.yml","hash":"63a3e1e728ba5e6e22150de7331bb8a654f34960","modified":1649516914346},{"_id":"themes/next/languages/ru.yml","hash":"8c2b6361f2de17561c1a3eede2bf47b4e2ba6ce5","modified":1649516914347},{"_id":"themes/next/languages/si.yml","hash":"615d18d044f44df476d6bfbf73f7b0edc2632168","modified":1649516914347},{"_id":"themes/next/languages/tk.yml","hash":"519239e35c3bda7b62b00ff5d34644f45b16fe6a","modified":1649516914347},{"_id":"themes/next/languages/tr.yml","hash":"0bebba73d6f06c7dad61f80c0d7ad5f6f1791a01","modified":1649516914347},{"_id":"themes/next/languages/uk.yml","hash":"7dd24580c0865c5a7bc4d391855045366a598936","modified":1649516914348},{"_id":"themes/next/languages/vi.yml","hash":"c669c34da544a563ceae3e196addc9df6a78e024","modified":1649516914348},{"_id":"themes/next/languages/zh-CN.yml","hash":"5a3ab21210304efef736e96bad254f789f42c567","modified":1649516914349},{"_id":"themes/next/languages/zh-HK.yml","hash":"f195bb0502ffe66e850077a1af1033455ea65f93","modified":1649516914350},{"_id":"themes/next/languages/zh-TW.yml","hash":"92256b90028de9a1e79c6bc0e5885b93e7fb4b17","modified":1649516914350},{"_id":"themes/next/layout/_layout.njk","hash":"20e4160cd0deb4fa272cc3aed0f43520b3cf4a9c","modified":1649516914351},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1649516914378},{"_id":"themes/next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1649516914378},{"_id":"themes/next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1649516914379},{"_id":"themes/next/layout/page.njk","hash":"6c40aa438c658eb7f0cd0f6a759f18b43e7e8f93","modified":1649516914379},{"_id":"themes/next/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":1649516914379},{"_id":"themes/next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1649516914379},{"_id":"themes/next/test/index.js","hash":"6bf0289846538be3e9a63809af98f00e1fbdd90b","modified":1649516914467},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"fc4dce84ed9a5d21d3a8833ff6d776c46f876115","modified":1649516914323},{"_id":"themes/next/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1649516914323},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"4ecac91716eac59d7c2bc53cf6e95612d44da97b","modified":1649516914324},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"8cc5b5c116f6a052865a324512362f145d699202","modified":1649516914324},{"_id":"themes/next/.github/workflows/label-commenter.yml","hash":"434cc0674290958b1e9bbc46c3486f073c0722db","modified":1649516914327},{"_id":"themes/next/.github/workflows/labeler.yml","hash":"e9d51e93f239a2d4b69722c69db3463b4baf0f4c","modified":1649516914327},{"_id":"themes/next/.github/workflows/linter.yml","hash":"b6c111344bc0f3500ca69d7590791ff85ef1090d","modified":1649516914328},{"_id":"themes/next/.github/workflows/lock.yml","hash":"e48d1ced9a673d3f0911a700d3e68c0f4ca79263","modified":1649516914328},{"_id":"themes/next/.github/workflows/release-drafter.yml","hash":"4f3af81009cb922be91f718a67425377515ea69d","modified":1649516914329},{"_id":"themes/next/.github/workflows/tester.yml","hash":"80a20c3a7522249f051a48239db41d1317e9b552","modified":1649516914329},{"_id":"themes/next/docs/ru/README.md","hash":"7d39204791687179576e22891a1a31766a089171","modified":1649516914341},{"_id":"themes/next/scripts/events/index.js","hash":"3ce10d4cce94e3d4c482c2e18bb6f0f0ca380d3d","modified":1649516914380},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1649516914386},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1649516914342},{"_id":"themes/next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1649516914388},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1649516914341},{"_id":"themes/next/docs/zh-CN/README.md","hash":"3d09c345d2e2ae2ab0fca10ff39b3b543b152c09","modified":1649516914343},{"_id":"themes/next/scripts/filters/minify.js","hash":"3abdcb715562414063e0fb3eeb6244ce59c477e0","modified":1649516914389},{"_id":"themes/next/scripts/filters/post.js","hash":"30e03a1d4828259f82d46e64cbfe2955b6cff9a9","modified":1649516914390},{"_id":"themes/next/scripts/helpers/engine.js","hash":"72d4464cf01f8f34e524f26a1e9b1d063504e92d","modified":1649516914396},{"_id":"themes/next/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1649516914400},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1649516914404},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"9a07f2d979fc8fe0c5e07d48304187b9b03ea7ff","modified":1649516914405},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"a11b71ba0c5012e2cdcab31c15439156b215563e","modified":1649516914408},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1649516914409},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1649516914410},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1649516914410},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1649516914410},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1649516914411},{"_id":"themes/next/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1649516914411},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1649516914411},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1649516914412},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1649516914412},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1649516914412},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1649516914413},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1649516914413},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1649516914413},{"_id":"themes/next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1649516914352},{"_id":"themes/next/layout/_partials/footer.njk","hash":"19713f472972caac33ae5fbcfe9105da61257de4","modified":1649516914353},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1649516914367},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1649516914359},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"852a750524decf1efa587cd52b09e387ed8315de","modified":1649516914370},{"_id":"themes/next/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1649516914370},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1649516914370},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1649516914374},{"_id":"themes/next/layout/_third-party/index.njk","hash":"d41eeb262978e34de4679d8971a9e7ac5d90ecbc","modified":1649516914374},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1649516914376},{"_id":"themes/next/layout/_third-party/rating.njk","hash":"1bcdbc7fde26d6d9ef4e7fa43ffcff5a9506b20e","modified":1649516914376},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1649516914376},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1649516914351},{"_id":"themes/next/layout/_macro/post.njk","hash":"434b3e76a040a816169e1929657e4176e7b8164c","modified":1649516914352},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"eb786e8b35e354287cda345c524cd35ec955f692","modified":1649516914352},{"_id":"themes/next/source/css/_colors.styl","hash":"3c6798c10cc220d83481cb3f3782e78558cee789","modified":1649516914414},{"_id":"themes/next/source/css/_mixins.styl","hash":"32d31cb5a155681c19f5ad0bb56dcb08429f93ef","modified":1649516914446},{"_id":"themes/next/source/css/main.styl","hash":"78ce791cc4ac95386cf6839ca72f5f7b51f86ee9","modified":1649516914453},{"_id":"themes/next/source/css/noscript.styl","hash":"76bba5d7916e9930e68215a0fce3a7d81c44510f","modified":1649516914453},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1649516914453},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1649516914454},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1649516914455},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1649516914455},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1649516914456},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1649516914458},{"_id":"themes/next/source/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1649516914457},{"_id":"themes/next/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1649516914458},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1649516914459},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1649516914459},{"_id":"themes/next/source/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1649516914459},{"_id":"themes/next/source/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1649516914459},{"_id":"themes/next/source/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1649516914460},{"_id":"themes/next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1649516914460},{"_id":"themes/next/source/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1649516914467},{"_id":"themes/next/test/helpers/font.js","hash":"342ef3c6fd2dcca2a8802a516ed6d7f389fd2ca2","modified":1649516914467},{"_id":"themes/next/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1649516914467},{"_id":"themes/next/test/helpers/next-url.js","hash":"a91d880cb75e0a8e65a7be4c7362b2c8ebfb7c4f","modified":1649516914467},{"_id":"themes/next/test/tags/button.js","hash":"48f2aa4c513e9e24bd6a811410520b74cd7ea88b","modified":1649516914468},{"_id":"themes/next/test/tags/caniuse.js","hash":"aa5e728445caeaf7c2ccd0f3fcb2cad0c93ca6d1","modified":1649516914468},{"_id":"themes/next/test/tags/center-quote.js","hash":"7667342fd1a1417eaf6a254012b84ae40e8d13dd","modified":1649516914468},{"_id":"themes/next/test/tags/group-pictures.js","hash":"5c68ae0184f9da6e00ba199f2554d503d8e6da71","modified":1649516914468},{"_id":"themes/next/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1649516914468},{"_id":"themes/next/test/tags/label.js","hash":"4ebf3698c258ca978b997acbdd0dece44069c09d","modified":1649516914468},{"_id":"themes/next/test/tags/link-grid.js","hash":"43d298fafb7c45a874b766d443843bd26346e689","modified":1649516914469},{"_id":"themes/next/test/tags/mermaid.js","hash":"ab77be5f3c6d9a57c7b9dda6decf1906a736fef9","modified":1649516914469},{"_id":"themes/next/test/tags/note.js","hash":"3dcfcd65bf9f326972ea7571fdb1444200f5d07e","modified":1649516914469},{"_id":"themes/next/test/tags/pdf.js","hash":"fd6ea5123560a90f7e7c1eface23dbe1455db25f","modified":1649516914469},{"_id":"themes/next/test/tags/tabs.js","hash":"d63722919f9da2e44d6b952801e10a2915ea9c12","modified":1649516914469},{"_id":"themes/next/test/tags/video.js","hash":"b796fc4dceb20a30e730c322bb5474c0162464cc","modified":1649516914469},{"_id":"themes/next/test/validate/index.js","hash":"5a95ccc8598667535bd022e988055c0e019f3670","modified":1649516914470},{"_id":"themes/next/scripts/events/lib/config.js","hash":"c8b59b404f5d2a0b3b5cd1a6c9a10af5f30e43b5","modified":1649516914381},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1649516914381},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1649516914381},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1649516914381},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"ec996d0673f766167c86df0966e9da1ae036e103","modified":1649516914382},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"0d94ac5daa95f99046d66160d9f0f34ee786736c","modified":1649516914382},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"7fa8701c86485b2fe7324e017101a32417902397","modified":1649516914383},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1649516914383},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1649516914383},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1649516914383},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"135b87d151055eefdbc711d9e704b112b3214a84","modified":1649516914384},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1649516914384},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1649516914384},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1649516914384},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1649516914385},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"8da52a144060db1a0a088ccb2e6cc8376d1fce70","modified":1649516914354},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"0ba2bf0266f1fcb8edbd961869f8521b29685c56","modified":1649516914354},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"aff4613756456be26415febc668860fdab8d33c5","modified":1649516914355},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1649516914356},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"41a8b0cc16f60fa085cb719d07216d86b6bc4bf8","modified":1649516914357},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1649516914358},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1649516914360},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1649516914359},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1649516914362},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1649516914363},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1649516914364},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1649516914366},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1649516914367},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"154df0bb323c332d8c25343f258ee865e5553423","modified":1649516914368},{"_id":"themes/next/layout/_partials/post/post-footer.njk","hash":"bde2c7356d9362972bde41cc206d5816f8ed714d","modified":1649516914368},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1649516914368},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"57eca76cfbbe9a65bc2a77f1deebf003ed335673","modified":1649516914368},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"002b51d0cae3f2e2e008bdc58be90c728282de5b","modified":1649516914369},{"_id":"themes/next/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1649516914369},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1649516914369},{"_id":"themes/next/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1649516914369},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1649516914372},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"3d8591bb92df77ceb9d5b07bc76da1ca89e5bd76","modified":1649516914370},{"_id":"themes/next/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1649516914372},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1649516914372},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1649516914371},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"c978e9efd472c4825f93b83524b11f1c4f7efaab","modified":1649516914371},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1649516914371},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1649516914371},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"45477a04cf2b3c077061c8c3ada216c1ae288e0e","modified":1649516914371},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"9dc00fcb0a05899f048eace9f9160b78956655d5","modified":1649516914371},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1649516914372},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1649516914373},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1649516914373},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1649516914373},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1649516914373},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1649516914374},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1649516914374},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1649516914375},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"d82c24136bbd3443b85f07f5579845833b594684","modified":1649516914375},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1649516914375},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1649516914376},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1649516914377},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1649516914377},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1649516914377},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1649516914377},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1649516914377},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1649516914378},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1649516914378},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1649516914451},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e1fbf169b9b6a194b518240cbd06ec3c48b83d61","modified":1649516914451},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1649516914452},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":1649516914452},{"_id":"themes/next/source/css/_variables/base.styl","hash":"163c7441d777bee87042d475e6ce0fde199add28","modified":1649516914452},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1649516914464},{"_id":"themes/next/source/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1649516914460},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1649516914465},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1649516914465},{"_id":"themes/next/source/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1649516914465},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"bab653bcf226311381e8411a0492202f1bf1fce9","modified":1649516914415},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"fe1868f47681e00a33a96199302be85377282f63","modified":1649516914416},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1649516914424},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1649516914432},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"64775c729512b30b144ab5ae9dc4a4dfd4e13f35","modified":1649516914433},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1649516914439},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"fd49b521d67eaccc629f77b4e095cb7310327565","modified":1649516914446},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1649516914440},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1649516914439},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1649516914443},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"b5c7782368889fa9fd93807d28ff2daf270e3703","modified":1649516914443},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1649516914442},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1649516914444},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":1649516914446},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"4817e77577896ab5c0da434549917ee703a3f4cf","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fb550935d374e0bdf1097fce187337dc05cad3e1","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"be6cf377ae8f4a01ee76f9b3014e74161d4d5d17","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":1649516914447},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":1649516914448},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b7f48be3c43bfa393d62142544a5487a67871713","modified":1649516914448},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"944364893bd7160d954c10ba931af641c91515a4","modified":1649516914448},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1649516914448},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1649516914449},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"b741ab96e73370711c63a6581159f2ea8b5bfa1b","modified":1649516914449},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":1649516914450},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1649516914450},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1649516914450},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"d9141e6e14a56b5952488101e9a8388c2170e270","modified":1649516914450},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1649516914451},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1649516914461},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1649516914461},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1649516914461},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1649516914462},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1649516914462},{"_id":"themes/next/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1649516914462},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1649516914464},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1649516914464},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1649516914463},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1649516914463},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1649516914463},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1649516914463},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1649516914463},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1649516914464},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1649516914464},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1649516914465},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1649516914466},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"411a72df581f5b21317dc28633c7993207eb9e1c","modified":1649516914466},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1649516914466},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1649516914466},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1649516914466},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1649516914417},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1649516914418},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1649516914419},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1649516914419},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"d0805a763176b3c0003967401644f41dfe3bc9e8","modified":1649516914420},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1649516914420},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"ea351936d71e0b6259febac3d7d56d1be6927bf9","modified":1649516914421},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"fc1a7bac6493f24aa50665574f37f3dd954f210c","modified":1649516914421},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1649516914421},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1649516914422},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"1d284f3ea03ba9b4feb76b375e539a8e0bccf1c3","modified":1649516914422},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1649516914423},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1649516914423},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"07cff69f2d57e6321595f64c16d8b763dc88df6a","modified":1649516914423},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"b6677dc2a2368084ab82bb4f145ac79e5966c150","modified":1649516914423},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"c2326ee3e8b724d99c24a818ddee32813ea5bf89","modified":1649516914424},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"070737d101e7cd58e997e8c7af09958268c43a21","modified":1649516914425},{"_id":"themes/next/source/css/_common/components/third-party/gitter.styl","hash":"35104dc6883a61c31e0e368dac8ac2f697be62fe","modified":1649516914425},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"979486a41a81f2a9fd8b0b87c4f87d6416c68c7d","modified":1649516914426},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1649516914426},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"41ed817e1eb64078074e245e771446ee041e5790","modified":1649516914427},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1649516914428},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1649516914428},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1649516914430},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"8b9407e5cfd0571ef8de7df19022b268f962fa2f","modified":1649516914429},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"650ed4ad6df1b6ff04647e7b6d568304e4d3ed2e","modified":1649516914431},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"759e582d34d08e3386c55d87a835a9523608619f","modified":1649516914431},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1649516914432},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1649516914430},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"392fd53a8dd4e3f33a853ebb24290a622300e0ff","modified":1649516914431},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"cee43480eba028c37d51cb620c2d81486aa24e01","modified":1649516914433},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1649516914433},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"9950c3188a28e1c63b5498b7bdcd14b12ace3e28","modified":1649516914435},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1649516914435},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1649516914434},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"3103b81fc76b59e1e2c161e2c484625c770ed66f","modified":1649516914437},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"ee94a1a27090ad24e3ed579093088d97ff96d77d","modified":1649516914436},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"fbdb63c6a8887d19b7137325ba7d6806f728139c","modified":1649516914436},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"021a37cf178440cc341940a299d3bca359996c6b","modified":1649516914437},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":1649516914441},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1649516914438},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1649516914444},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"f2328caa94645836e06fb39a6a9c9a84ed68a8b5","modified":1649516914441},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1649516914444},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"3f76c73a891bbc10679753e702feba9e8a5ffdd2","modified":1649516914444},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1649516914444},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1649516914445},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1649516914445},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1649516914445},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"d27fbf7799695295dd5860a161a13ac4d90c5ba4","modified":1649516914445},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"7a39bcce7274284e87388743db62afc847fe6897","modified":1649516914446},{"_id":"public/atom.xml","hash":"8fe4c4651a4025b54743b3a9c4a79f85d505589a","modified":1650196319032},{"_id":"public/about/index.html","hash":"7045f54c04578855d6441061f9723f728485faa3","modified":1650196080515},{"_id":"public/tags/index.html","hash":"62da484343f6816a34e32cf7c5c24bf9d4c569f1","modified":1650196080515},{"_id":"public/archives/index.html","hash":"13d3e5ba0abd6a72bb227d7747bc339123192019","modified":1650196080515},{"_id":"public/archives/2018/index.html","hash":"eb0377aa0709ba4ac538f9a255881d01e17188ae","modified":1650196080515},{"_id":"public/archives/2018/03/index.html","hash":"c04d7c19d25955c0f99b9f8d042d84d2b9aca64a","modified":1650196080515},{"_id":"public/archives/2018/04/index.html","hash":"3a557564779429636fc033c76f5a97fe62c826a6","modified":1650196080515},{"_id":"public/index.html","hash":"ef8746fdd7322d97af51f753c1a217cf89374439","modified":1650196319032},{"_id":"public/tags/lua/index.html","hash":"1caa27499dad05451d22f586b5eda735a7c7ce68","modified":1650196080515},{"_id":"public/tags/webp/index.html","hash":"1d5237580fbc7e21284da9deff0444a470ea86f3","modified":1650196080515},{"_id":"public/tags/imagemagick/index.html","hash":"f993f73b8003deade086b64fe87bf2881cf2c479","modified":1650196080515},{"_id":"public/tags/http2/index.html","hash":"34d9c397c526ec17ec28c975a6ba01b36e7461b9","modified":1650196080515},{"_id":"public/tags/nginx/index.html","hash":"7c9f0be8a97a2017e16bb796e150798855b27a54","modified":1650196080515},{"_id":"public/tags/grpc/index.html","hash":"7ea39168b1695747fee0b2ed08f8a810427b85af","modified":1650196080515},{"_id":"public/2018/04/09/build-imagemagick-libwebp-with-jpeg-turbo-from-source/index.html","hash":"158c14b26893768de5bebdadd47a29ac07faa869","modified":1650196080515},{"_id":"public/2018/03/23/nginx-http2-grpc/index.html","hash":"49d2a38418a41635d050354a2480c70bac35c538","modified":1650196319032},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1649564061489},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1649564061489},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1649564061489},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1649564061489},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1649564061489},{"_id":"public/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1649564061489},{"_id":"public/CNAME","hash":"ece6ac05f132955736470e4033c10926dc3e65fe","modified":1649564061489},{"_id":"public/css/noscript.css","hash":"25cb5f4b273e1635b157abe6fa34b846adff1937","modified":1649564061489},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1649564061489},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1649564061489},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1649564061489},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1649564061489},{"_id":"public/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1649564061489},{"_id":"public/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1649564061489},{"_id":"public/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1649564061489},{"_id":"public/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1649564061489},{"_id":"public/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1649564061489},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1649564061489},{"_id":"public/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1649564061489},{"_id":"public/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1649564061489},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1649564061489},{"_id":"public/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1649564061489},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1649564061489},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1649564061489},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1649564061489},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1649564061489},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1649564061489},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1649564061489},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1649564061489},{"_id":"public/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1649564061489},{"_id":"public/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1649564061489},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1649564061489},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1649564061489},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1649564061489},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1649564061489},{"_id":"public/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1649564061489},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1649564061489},{"_id":"public/js/third-party/statistics/firestore.js","hash":"411a72df581f5b21317dc28633c7993207eb9e1c","modified":1649564061489},{"_id":"public/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1649564061489},{"_id":"public/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1649564061489},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1649564061489},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1649564061489},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1649564061489},{"_id":"public/css/main.css","hash":"03299fbb37fd428a0a3597900ff07bd7f10286f2","modified":1649564061489},{"_id":"source/_posts/pick-up-blog.md","hash":"928ec046eab1076876e35ef536731eef4bba0ee1","modified":1650196075955},{"_id":"public/tags/journal/index.html","hash":"4e2976b4aec16e1d6443d4989047bba28af1a76a","modified":1650196080515},{"_id":"public/2022/04/10/pick-up-blog/index.html","hash":"0158aa77de56cc0cead7fbfbff2ffef3724dbbe9","modified":1650196080515},{"_id":"public/archives/2022/04/index.html","hash":"27a23bbd6ba99c075f2fe78c848cd1c2384d26de","modified":1650196080515},{"_id":"public/archives/2022/index.html","hash":"9345cc08e0d7d7fc90ca9b4c6a9bb427403e26f1","modified":1650196080515},{"_id":"source/_posts/openstack-arch-enterprise-requirements.md","hash":"92ce8c254aa2910dc14638679a457f4235f6b055","modified":1650195999916},{"_id":"public/tags/openstack/index.html","hash":"5d30a2e77843100111c2cdbbcb4bfcf40138aa3e","modified":1650196080515},{"_id":"public/2022/04/15/openstack-arch-enterprise-requirements/index.html","hash":"5774413ecfa4d224fdf8d334cbfc648e87cba382","modified":1650196080515},{"_id":"public/tags/arch/index.html","hash":"615c0273b490a8c0ea0b25aedaec9a203a15481a","modified":1650196080515},{"_id":"public/2022/04/17/nginx-http2-grpc/index.html","hash":"c46b82898093fd1079598c2cda816f46af5bf4b8","modified":1650195897614},{"_id":"public/2022/04/17/openstack-arch-enterprise-requirements/index.html","hash":"17ed7b0829874de0dcb95ca3b6be1feac1172734","modified":1650195949976},{"_id":"public/2022/04/10/build-imagemagick-libwebp-with-jpeg-turbo-from-source/index.html","hash":"66b2ba968b06775bc0e6c22d35a9163109a40909","modified":1650195949976}],"Category":[],"Data":[],"Page":[{"_content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n---\n\ntitle: about\ndate: 2018-04-10 12:44:42\n---\n\n### Hi there, I'm kwanhur 👋\n\n> focus on NFV(Load Balancer), NetDevOps enthusiasitic, Open Source Contributor of Apache APISIX, CNCF sandbox BFE, Moby ipvs etc.\n\n### 👨‍🏭 About me\n\n- 💼 A Senior Backend Engineer\n- 🏢 working on cloud-network department, ctyun.cn\n- 🏠 based at Guangzhou, China\n\n### 🧰 Tech Stack\n\n- 💻  golang | python| lua\n- 🛢 postgresql | redis |etcd|kafka\n- 🌐 Openstack Neutron | Openvswitch | LVS | OpenResty | Nginx | APISIX | BFE\n- 🔧 Vim | Git | Bash | Goland | Idea\n","source":"about/index.md","raw":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n---\n\ntitle: about\ndate: 2018-04-10 12:44:42\n---\n\n### Hi there, I'm kwanhur 👋\n\n> focus on NFV(Load Balancer), NetDevOps enthusiasitic, Open Source Contributor of Apache APISIX, CNCF sandbox BFE, Moby ipvs etc.\n\n### 👨‍🏭 About me\n\n- 💼 A Senior Backend Engineer\n- 🏢 working on cloud-network department, ctyun.cn\n- 🏠 based at Guangzhou, China\n\n### 🧰 Tech Stack\n\n- 💻  golang | python| lua\n- 🛢 postgresql | redis |etcd|kafka\n- 🌐 Openstack Neutron | Openvswitch | LVS | OpenResty | Nginx | APISIX | BFE\n- 🔧 Vim | Git | Bash | Goland | Idea\n","date":"2022-04-17T11:40:49.362Z","updated":"2022-04-17T11:40:49.362Z","path":"about/index.html","_id":"cl1sruq6l0000qlvh3c6z5xqz","title":"","comments":1,"layout":"page","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n<hr>\n<p>title: about<br>date: 2018-04-10 12:44:42</p>\n<hr>\n<h3 id=\"Hi-there-I’m-kwanhur-👋\"><a href=\"#Hi-there-I’m-kwanhur-👋\" class=\"headerlink\" title=\"Hi there, I’m kwanhur 👋\"></a>Hi there, I’m kwanhur 👋</h3><blockquote>\n<p>focus on NFV(Load Balancer), NetDevOps enthusiasitic, Open Source Contributor of Apache APISIX, CNCF sandbox BFE, Moby ipvs etc.</p>\n</blockquote>\n<h3 id=\"👨‍🏭-About-me\"><a href=\"#👨‍🏭-About-me\" class=\"headerlink\" title=\"👨‍🏭 About me\"></a>👨‍🏭 About me</h3><ul>\n<li>💼 A Senior Backend Engineer</li>\n<li>🏢 working on cloud-network department, ctyun.cn</li>\n<li>🏠 based at Guangzhou, China</li>\n</ul>\n<h3 id=\"🧰-Tech-Stack\"><a href=\"#🧰-Tech-Stack\" class=\"headerlink\" title=\"🧰 Tech Stack\"></a>🧰 Tech Stack</h3><ul>\n<li>💻  golang | python| lua</li>\n<li>🛢 postgresql | redis |etcd|kafka</li>\n<li>🌐 Openstack Neutron | Openvswitch | LVS | OpenResty | Nginx | APISIX | BFE</li>\n<li>🔧 Vim | Git | Bash | Goland | Idea</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n<hr>\n<p>title: about<br>date: 2018-04-10 12:44:42</p>\n<hr>\n<h3 id=\"Hi-there-I’m-kwanhur-👋\"><a href=\"#Hi-there-I’m-kwanhur-👋\" class=\"headerlink\" title=\"Hi there, I’m kwanhur 👋\"></a>Hi there, I’m kwanhur 👋</h3><blockquote>\n<p>focus on NFV(Load Balancer), NetDevOps enthusiasitic, Open Source Contributor of Apache APISIX, CNCF sandbox BFE, Moby ipvs etc.</p>\n</blockquote>\n<h3 id=\"👨‍🏭-About-me\"><a href=\"#👨‍🏭-About-me\" class=\"headerlink\" title=\"👨‍🏭 About me\"></a>👨‍🏭 About me</h3><ul>\n<li>💼 A Senior Backend Engineer</li>\n<li>🏢 working on cloud-network department, ctyun.cn</li>\n<li>🏠 based at Guangzhou, China</li>\n</ul>\n<h3 id=\"🧰-Tech-Stack\"><a href=\"#🧰-Tech-Stack\" class=\"headerlink\" title=\"🧰 Tech Stack\"></a>🧰 Tech Stack</h3><ul>\n<li>💻  golang | python| lua</li>\n<li>🛢 postgresql | redis |etcd|kafka</li>\n<li>🌐 Openstack Neutron | Openvswitch | LVS | OpenResty | Nginx | APISIX | BFE</li>\n<li>🔧 Vim | Git | Bash | Goland | Idea</li>\n</ul>\n"},{"_content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n---\n\ntitle: 文章标签\ndate: 2022-04-10 00:06:27\ntype: \"tags\"\n---\n","source":"tags/index.md","raw":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n---\n\ntitle: 文章标签\ndate: 2022-04-10 00:06:27\ntype: \"tags\"\n---\n","date":"2022-04-17T11:40:49.366Z","updated":"2022-04-17T11:40:49.366Z","path":"tags/index.html","_id":"cl1sruq6y0002qlvhbxiqbtwj","title":"","comments":1,"layout":"page","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n<hr>\n<p>title: 文章标签<br>date: 2022-04-10 00:06:27<br>type: “tags”</p>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n<hr>\n<p>title: 文章标签<br>date: 2022-04-10 00:06:27<br>type: “tags”</p>\n<hr>\n"}],"Post":[{"title":"build-imagemagick-libwebp-with-jpeg-turbo-from-source","date":"2018-04-09T05:46:26.000Z","_content":"\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n对于喜欢折腾的人，安装所需系统库都是手工源码编译出来使用，这或许有种可控的感觉。\n\n相比直接使用软件库已编译好的，源码编译可更加自由选择或指定版本。\n\n近期在 CentOS-7.2 系统上，升级 webp 图片依赖系统库时，整理了个一键编译 ImageMagick 脚本，如下：\n\n<!--more-->\n\n```bash\n$ head  -n 1 /etc/redhat-release \n\nCentOS Linux release 7.2.1511 (Core) \n\n$ uname -r\n3.10.0-327.el7.x86_64\n\nmkdir -p /export/svr /export/lib\nDIR=/export/svr\nPREFIX=/export/lib\n\nJPEG_VER=1.5.2\nPNG_VER=1.6.34\nGIF_VER=5.1.4\nWEBP_VER=0.6.1\nIMAGICK_VER=7.0.7-26\n\nif [ ! -e $PREFIX/libjpeg-turbo-$JPEG_VER.tar.gz ];then\n  wget https://jaist.dl.sourceforge.net/project/libjpeg-turbo/$JPEG_VER/libjpeg-turbo-$JPEG_VER.tar.gz -O $PREFIX/libjpeg-turbo-$JPEG_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/libpng-$PNG_VER.tar.gz ];then\n  wget https://jaist.dl.sourceforge.net/project/libpng/libpng16/$PNG_VER/libpng-$PNG_VER.tar.gz -O $PREFIX/libpng-$PNG_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/giflib-$GIF_VER.tar.bz2 ];then\n  wget https://jaist.dl.sourceforge.net/project/giflib/giflib-$GIF_VER.tar.bz2 -O $PREFIX/giflib-$GIF_VER.tar.bz2\nfi\n\nif [ ! -e $PREFIX/libwebp-$WEBP_VER.tar.gz ];then\n  wget https://codeload.github.com/webmproject/libwebp/tar.gz/v$WEBP_VER -O $PREFIX/libwebp-$WEBP_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/ImageMagick-$IMAGICK_VER.tar.gz ];then\n  wget https://codeload.github.com/ImageMagick/ImageMagick/tar.gz/$IMAGICK_VER -O $PREFIX/ImageMagick-$IMAGICK_VER.tar.gz\nfi\n\ncd $PREFIX\nrm -fr libjpeg-turbo-$JPEG_VER libpng-$PNG_VER giflib-$GIF_VER libwebp-$WEBP_VER ImageMagick-$IMAGICK_VER\n\n#base package\nyum install -y -q libtool libtool-ltdl libtool-ltdl-devel gcc make autoconf automake readline-devel nasm\n\n#libjpeg-turbo\nunlink $PREFIX/libjpeg-turbo\nrm -rf $PREFIX/libjpeg-turbo-$JPEG_VER\ncd ${DIR}/libjpeg-turbo-$JPEG_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/libjpeg-turbo-$JPEG_VER && make -j24 && make -j24 install\nln -sfnv $PREFIX/libjpeg-turbo-$JPEG_VER $PREFIX/libjpeg-turbo\n\ntest $? -eq 0 && echo \"install_status libjpeg-turbo OK\"||echo \"install_status libjpeg-turbo failed\"\nsudo cp -a $PREFIX/libjpeg-turbo/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libjpeg-turbo/lib\" > /etc/ld.so.conf.d/jpeg-turbo.conf\n\n#libpng\nunlink $PREFIX/libpng\nrm -rf $PREFIX/libpng-$PNG_VER\ncd ${DIR}/libpng-$PNG_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/libpng-$PNG_VER && make -j24 && make -j24 install\nln -sfnv $PREFIX/libpng-$PNG_VER $PREFIX/libpng\n\ntest $? -eq 0 && echo \"install_status libpng OK\"||echo \"install_status libpng failed\"\nsudo cp -a $PREFIX/libpng/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libpng/lib\" > /etc/ld.so.conf.d/libpng.conf\n\n#giflib\nunlink $PREFIX/giflib\nrm -fr $PREFIX/giflib-$GIF_VER\ncd ${DIR}/giflib-$GIF_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/giflib-$GIF_VER && make -j24 && make install\nln -sfnv $PREFIX/giflib-$GIF_VER $PREFIX/giflib \n\ntest $? -eq 0 && echo \"install_status giflib OK\" || echo \"install_status giflib failed\"\nsudo echo \"$PREFIX/giflib/lib\" > /etc/ld.so.conf.d/giflib.conf\n\n#libwebp\ncd ${DIR}/libwebp-$WEBP_VER\nmake clean >/dev/null\nunlink $PREFIX/libwebp\nrm -rf $PREFIX/libwebp-$WEBP_VER\n./configure --prefix=$PREFIX/libwebp-$WEBP_VER --enable-everything --disable-tiff --disable-wic \\\n--with-gifincludedir=$PREFIX/giflib/include --with-giflibdir=$PREFIX/giflib/lib \\\n--with-jpegincludedir=$PREFIX/libjpeg-turbo/include --with-jpeglibdir=$PREFIX/libjpeg-turbo/lib \\\n--with-pngincludedir=$PREFIX/libpng/include --with-pnglibdir=$PREFIX/libpng/lib && make -j24 && make install\nln -sfnv $PREFIX/libwebp-$WEBP_VER $PREFIX/libwebp\n\ntest $? -eq 0 && echo \"install_status libwebp OK\"||echo \"install_status libwebp failed\"\nsudo cp -a $PREFIX/libwebp/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libwebp/lib\" > /etc/ld.so.conf.d/libwebp.conf\n\n#webp support yes\ncd ${DIR}/ImageMagick-$IMAGICK_VER\nunlink $PREFIX/imagemagick\nrm -rf $PREFIX/imagemagick-$IMAGICK_VER\nmake clean >/dev/null \nexport PKG_CONFIG=/usr/bin/pkg-config\nexport CPPFLAGS=\"-I$PREFIX/libjpeg-turbo/include\"\nexport LDFLAGS=\"-L$PREFIX/libjpeg-turbo/lib\"\n./configure --prefix=$PREFIX/imagemagick-$IMAGICK_VER --enable-static --enable-shared  --disable-docs  \\\n--with-modules --with-webp=yes --disable-openmp --enable-delegate-build && make -j 24 && make install\nln -sfnv $PREFIX/imagemagick-$IMAGICK_VER $PREFIX/imagemagick\n\ntest $? -eq 0 && echo \"install_status imagemagick OK\"||echo \"install_status imagemagick failed\"\nsudo cp -a $PREFIX/imagemagick/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/imagemagick/lib\" > /etc/ld.so.conf.d/imagemagick.conf\n\n#pacakge imagemagick with dependent libraries\nVERSION=7.0.7-26\nLIB_PKG=/usr/lib64/pkgconfig\nLD_CONF=/etc/ld.so.conf.d\n\ntar -jPcf imagemagick-$VERSION.tar.bz2 $PREFIX/imagemagick $PREFIX/imagemagick-7.0.7-26 $PREFIX/giflib \\\n$PREFIX/giflib-$GIF_VER $PREFIX/libpng $PREFIX/libpng-$PNG_VER $PREFIX/libwebp $PREFIX/libwebp-$WEBP_VER \\\n$PREFIX/libjpeg-turbo $PREFIX/libjpeg-turbo-$JPEG_VER \\\n$LIB_PKG/ImageMagick-7.Q16HDRI.pc $LIB_PKG/ImageMagick.pc $LIB_PKG/Magick++-7.Q16HDRI.pc $LIB_PKG/MagickCore-7.Q16HDRI.pc \\\n$LIB_PKG/MagickCore.pc $LIB_PKG/Magick++.pc $LIB_PKG/MagickWand-7.Q16HDRI.pc $LIB_PKG/MagickWand.pc $LIB_PKG/libwebpdecoder.pc \\\n$LIB_PKG/libwebpdemux.pc $LIB_PKG/libwebpmux.pc $LIB_PKG/libwebp.pc $LIB_PKG/libjpeg.pc $LIB_PKG/libturbojpeg.pc \\\n$LD_CONF/jpeg-turbo.conf $LD_CONF/libwebp.conf $LD_CONF/imagemagick.conf $LD_CONF/giflib.conf $LD_CONF/libpng.conf\n```\n\n通过该系统库，完美适配 [lua-resty-imagick](https://github.com/kwanhur/lua-resty-imagick) :)\n","source":"_posts/build-imagemagick-libwebp-with-jpeg-turbo-from-source.md","raw":"---\n\ntitle: build-imagemagick-libwebp-with-jpeg-turbo-from-source\ndate: 2018-04-09 13:46:26\ntags:\n    - lua\n    - webp\n    - imagemagick\n---\n\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n对于喜欢折腾的人，安装所需系统库都是手工源码编译出来使用，这或许有种可控的感觉。\n\n相比直接使用软件库已编译好的，源码编译可更加自由选择或指定版本。\n\n近期在 CentOS-7.2 系统上，升级 webp 图片依赖系统库时，整理了个一键编译 ImageMagick 脚本，如下：\n\n<!--more-->\n\n```bash\n$ head  -n 1 /etc/redhat-release \n\nCentOS Linux release 7.2.1511 (Core) \n\n$ uname -r\n3.10.0-327.el7.x86_64\n\nmkdir -p /export/svr /export/lib\nDIR=/export/svr\nPREFIX=/export/lib\n\nJPEG_VER=1.5.2\nPNG_VER=1.6.34\nGIF_VER=5.1.4\nWEBP_VER=0.6.1\nIMAGICK_VER=7.0.7-26\n\nif [ ! -e $PREFIX/libjpeg-turbo-$JPEG_VER.tar.gz ];then\n  wget https://jaist.dl.sourceforge.net/project/libjpeg-turbo/$JPEG_VER/libjpeg-turbo-$JPEG_VER.tar.gz -O $PREFIX/libjpeg-turbo-$JPEG_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/libpng-$PNG_VER.tar.gz ];then\n  wget https://jaist.dl.sourceforge.net/project/libpng/libpng16/$PNG_VER/libpng-$PNG_VER.tar.gz -O $PREFIX/libpng-$PNG_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/giflib-$GIF_VER.tar.bz2 ];then\n  wget https://jaist.dl.sourceforge.net/project/giflib/giflib-$GIF_VER.tar.bz2 -O $PREFIX/giflib-$GIF_VER.tar.bz2\nfi\n\nif [ ! -e $PREFIX/libwebp-$WEBP_VER.tar.gz ];then\n  wget https://codeload.github.com/webmproject/libwebp/tar.gz/v$WEBP_VER -O $PREFIX/libwebp-$WEBP_VER.tar.gz\nfi\n\nif [ ! -e $PREFIX/ImageMagick-$IMAGICK_VER.tar.gz ];then\n  wget https://codeload.github.com/ImageMagick/ImageMagick/tar.gz/$IMAGICK_VER -O $PREFIX/ImageMagick-$IMAGICK_VER.tar.gz\nfi\n\ncd $PREFIX\nrm -fr libjpeg-turbo-$JPEG_VER libpng-$PNG_VER giflib-$GIF_VER libwebp-$WEBP_VER ImageMagick-$IMAGICK_VER\n\n#base package\nyum install -y -q libtool libtool-ltdl libtool-ltdl-devel gcc make autoconf automake readline-devel nasm\n\n#libjpeg-turbo\nunlink $PREFIX/libjpeg-turbo\nrm -rf $PREFIX/libjpeg-turbo-$JPEG_VER\ncd ${DIR}/libjpeg-turbo-$JPEG_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/libjpeg-turbo-$JPEG_VER && make -j24 && make -j24 install\nln -sfnv $PREFIX/libjpeg-turbo-$JPEG_VER $PREFIX/libjpeg-turbo\n\ntest $? -eq 0 && echo \"install_status libjpeg-turbo OK\"||echo \"install_status libjpeg-turbo failed\"\nsudo cp -a $PREFIX/libjpeg-turbo/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libjpeg-turbo/lib\" > /etc/ld.so.conf.d/jpeg-turbo.conf\n\n#libpng\nunlink $PREFIX/libpng\nrm -rf $PREFIX/libpng-$PNG_VER\ncd ${DIR}/libpng-$PNG_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/libpng-$PNG_VER && make -j24 && make -j24 install\nln -sfnv $PREFIX/libpng-$PNG_VER $PREFIX/libpng\n\ntest $? -eq 0 && echo \"install_status libpng OK\"||echo \"install_status libpng failed\"\nsudo cp -a $PREFIX/libpng/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libpng/lib\" > /etc/ld.so.conf.d/libpng.conf\n\n#giflib\nunlink $PREFIX/giflib\nrm -fr $PREFIX/giflib-$GIF_VER\ncd ${DIR}/giflib-$GIF_VER\nmake clean >/dev/null\n./configure --prefix=$PREFIX/giflib-$GIF_VER && make -j24 && make install\nln -sfnv $PREFIX/giflib-$GIF_VER $PREFIX/giflib \n\ntest $? -eq 0 && echo \"install_status giflib OK\" || echo \"install_status giflib failed\"\nsudo echo \"$PREFIX/giflib/lib\" > /etc/ld.so.conf.d/giflib.conf\n\n#libwebp\ncd ${DIR}/libwebp-$WEBP_VER\nmake clean >/dev/null\nunlink $PREFIX/libwebp\nrm -rf $PREFIX/libwebp-$WEBP_VER\n./configure --prefix=$PREFIX/libwebp-$WEBP_VER --enable-everything --disable-tiff --disable-wic \\\n--with-gifincludedir=$PREFIX/giflib/include --with-giflibdir=$PREFIX/giflib/lib \\\n--with-jpegincludedir=$PREFIX/libjpeg-turbo/include --with-jpeglibdir=$PREFIX/libjpeg-turbo/lib \\\n--with-pngincludedir=$PREFIX/libpng/include --with-pnglibdir=$PREFIX/libpng/lib && make -j24 && make install\nln -sfnv $PREFIX/libwebp-$WEBP_VER $PREFIX/libwebp\n\ntest $? -eq 0 && echo \"install_status libwebp OK\"||echo \"install_status libwebp failed\"\nsudo cp -a $PREFIX/libwebp/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/libwebp/lib\" > /etc/ld.so.conf.d/libwebp.conf\n\n#webp support yes\ncd ${DIR}/ImageMagick-$IMAGICK_VER\nunlink $PREFIX/imagemagick\nrm -rf $PREFIX/imagemagick-$IMAGICK_VER\nmake clean >/dev/null \nexport PKG_CONFIG=/usr/bin/pkg-config\nexport CPPFLAGS=\"-I$PREFIX/libjpeg-turbo/include\"\nexport LDFLAGS=\"-L$PREFIX/libjpeg-turbo/lib\"\n./configure --prefix=$PREFIX/imagemagick-$IMAGICK_VER --enable-static --enable-shared  --disable-docs  \\\n--with-modules --with-webp=yes --disable-openmp --enable-delegate-build && make -j 24 && make install\nln -sfnv $PREFIX/imagemagick-$IMAGICK_VER $PREFIX/imagemagick\n\ntest $? -eq 0 && echo \"install_status imagemagick OK\"||echo \"install_status imagemagick failed\"\nsudo cp -a $PREFIX/imagemagick/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/\nsudo echo \"$PREFIX/imagemagick/lib\" > /etc/ld.so.conf.d/imagemagick.conf\n\n#pacakge imagemagick with dependent libraries\nVERSION=7.0.7-26\nLIB_PKG=/usr/lib64/pkgconfig\nLD_CONF=/etc/ld.so.conf.d\n\ntar -jPcf imagemagick-$VERSION.tar.bz2 $PREFIX/imagemagick $PREFIX/imagemagick-7.0.7-26 $PREFIX/giflib \\\n$PREFIX/giflib-$GIF_VER $PREFIX/libpng $PREFIX/libpng-$PNG_VER $PREFIX/libwebp $PREFIX/libwebp-$WEBP_VER \\\n$PREFIX/libjpeg-turbo $PREFIX/libjpeg-turbo-$JPEG_VER \\\n$LIB_PKG/ImageMagick-7.Q16HDRI.pc $LIB_PKG/ImageMagick.pc $LIB_PKG/Magick++-7.Q16HDRI.pc $LIB_PKG/MagickCore-7.Q16HDRI.pc \\\n$LIB_PKG/MagickCore.pc $LIB_PKG/Magick++.pc $LIB_PKG/MagickWand-7.Q16HDRI.pc $LIB_PKG/MagickWand.pc $LIB_PKG/libwebpdecoder.pc \\\n$LIB_PKG/libwebpdemux.pc $LIB_PKG/libwebpmux.pc $LIB_PKG/libwebp.pc $LIB_PKG/libjpeg.pc $LIB_PKG/libturbojpeg.pc \\\n$LD_CONF/jpeg-turbo.conf $LD_CONF/libwebp.conf $LD_CONF/imagemagick.conf $LD_CONF/giflib.conf $LD_CONF/libpng.conf\n```\n\n通过该系统库，完美适配 [lua-resty-imagick](https://github.com/kwanhur/lua-resty-imagick) :)\n","slug":"build-imagemagick-libwebp-with-jpeg-turbo-from-source","published":1,"updated":"2022-04-17T11:47:06.901Z","_id":"cl1sruq6q0001qlvh14khfkwr","comments":1,"layout":"post","photos":[],"link":"","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>对于喜欢折腾的人，安装所需系统库都是手工源码编译出来使用，这或许有种可控的感觉。</p>\n<p>相比直接使用软件库已编译好的，源码编译可更加自由选择或指定版本。</p>\n<p>近期在 CentOS-7.2 系统上，升级 webp 图片依赖系统库时，整理了个一键编译 ImageMagick 脚本，如下：</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">head</span>  -n 1 /etc/redhat-release </span><br><span class=\"line\"></span><br><span class=\"line\">CentOS Linux release 7.2.1511 (Core) </span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">uname</span> -r</span><br><span class=\"line\">3.10.0-327.el7.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /export/svr /export/lib</span><br><span class=\"line\">DIR=/export/svr</span><br><span class=\"line\">PREFIX=/export/lib</span><br><span class=\"line\"></span><br><span class=\"line\">JPEG_VER=1.5.2</span><br><span class=\"line\">PNG_VER=1.6.34</span><br><span class=\"line\">GIF_VER=5.1.4</span><br><span class=\"line\">WEBP_VER=0.6.1</span><br><span class=\"line\">IMAGICK_VER=7.0.7-26</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/libjpeg-turbo/<span class=\"variable\">$JPEG_VER</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz -O <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/libpng/libpng16/<span class=\"variable\">$PNG_VER</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz -O <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/giflib/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2 -O <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://codeload.github.com/webmproject/libwebp/tar.gz/v<span class=\"variable\">$WEBP_VER</span> -O <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://codeload.github.com/ImageMagick/ImageMagick/tar.gz/<span class=\"variable\">$IMAGICK_VER</span> -O <span class=\"variable\">$PREFIX</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$PREFIX</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -fr libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> libpng-<span class=\"variable\">$PNG_VER</span> giflib-<span class=\"variable\">$GIF_VER</span> libwebp-<span class=\"variable\">$WEBP_VER</span> ImageMagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#base package</span></span><br><span class=\"line\">yum install -y -q libtool libtool-ltdl libtool-ltdl-devel gcc make autoconf automake readline-devel nasm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libjpeg-turbo</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libjpeg-turbo</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> &amp;&amp; make -j24 &amp;&amp; make -j24 install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> <span class=\"variable\">$PREFIX</span>/libjpeg-turbo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libjpeg-turbo OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libjpeg-turbo failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib&quot;</span> &gt; /etc/ld.so.conf.d/jpeg-turbo.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libpng</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libpng</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libpng-<span class=\"variable\">$PNG_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> &amp;&amp; make -j24 &amp;&amp; make -j24 install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> <span class=\"variable\">$PREFIX</span>/libpng</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libpng OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libpng failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libpng/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libpng/lib&quot;</span> &gt; /etc/ld.so.conf.d/libpng.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#giflib</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/giflib</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -fr <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/giflib-<span class=\"variable\">$GIF_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> &amp;&amp; make -j24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> <span class=\"variable\">$PREFIX</span>/giflib </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status giflib OK&quot;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status giflib failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/giflib/lib&quot;</span> &gt; /etc/ld.so.conf.d/giflib.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libwebp</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libwebp-<span class=\"variable\">$WEBP_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libwebp</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span></span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> --enable-everything --disable-tiff --disable-wic \\</span><br><span class=\"line\">--with-gifincludedir=<span class=\"variable\">$PREFIX</span>/giflib/include --with-giflibdir=<span class=\"variable\">$PREFIX</span>/giflib/lib \\</span><br><span class=\"line\">--with-jpegincludedir=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/include --with-jpeglibdir=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib \\</span><br><span class=\"line\">--with-pngincludedir=<span class=\"variable\">$PREFIX</span>/libpng/include --with-pnglibdir=<span class=\"variable\">$PREFIX</span>/libpng/lib &amp;&amp; make -j24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> <span class=\"variable\">$PREFIX</span>/libwebp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libwebp OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libwebp failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libwebp/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libwebp/lib&quot;</span> &gt; /etc/ld.so.conf.d/libwebp.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#webp support yes</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/imagemagick</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null </span><br><span class=\"line\"><span class=\"built_in\">export</span> PKG_CONFIG=/usr/bin/pkg-config</span><br><span class=\"line\"><span class=\"built_in\">export</span> CPPFLAGS=<span class=\"string\">&quot;-I<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/include&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LDFLAGS=<span class=\"string\">&quot;-L<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib&quot;</span></span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span> --enable-static --enable-shared  --disable-docs  \\</span><br><span class=\"line\">--with-modules --with-webp=<span class=\"built_in\">yes</span> --disable-openmp --enable-delegate-build &amp;&amp; make -j 24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span> <span class=\"variable\">$PREFIX</span>/imagemagick</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status imagemagick OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status imagemagick failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/imagemagick/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/imagemagick/lib&quot;</span> &gt; /etc/ld.so.conf.d/imagemagick.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#pacakge imagemagick with dependent libraries</span></span><br><span class=\"line\">VERSION=7.0.7-26</span><br><span class=\"line\">LIB_PKG=/usr/lib64/pkgconfig</span><br><span class=\"line\">LD_CONF=/etc/ld.so.conf.d</span><br><span class=\"line\"></span><br><span class=\"line\">tar -jPcf imagemagick-<span class=\"variable\">$VERSION</span>.tar.bz2 <span class=\"variable\">$PREFIX</span>/imagemagick <span class=\"variable\">$PREFIX</span>/imagemagick-7.0.7-26 <span class=\"variable\">$PREFIX</span>/giflib \\</span><br><span class=\"line\"><span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> <span class=\"variable\">$PREFIX</span>/libpng <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> <span class=\"variable\">$PREFIX</span>/libwebp <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> \\</span><br><span class=\"line\"><span class=\"variable\">$PREFIX</span>/libjpeg-turbo <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/ImageMagick-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/ImageMagick.pc <span class=\"variable\">$LIB_PKG</span>/Magick++-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/MagickCore-7.Q16HDRI.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/MagickCore.pc <span class=\"variable\">$LIB_PKG</span>/Magick++.pc <span class=\"variable\">$LIB_PKG</span>/MagickWand-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/MagickWand.pc <span class=\"variable\">$LIB_PKG</span>/libwebpdecoder.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/libwebpdemux.pc <span class=\"variable\">$LIB_PKG</span>/libwebpmux.pc <span class=\"variable\">$LIB_PKG</span>/libwebp.pc <span class=\"variable\">$LIB_PKG</span>/libjpeg.pc <span class=\"variable\">$LIB_PKG</span>/libturbojpeg.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LD_CONF</span>/jpeg-turbo.conf <span class=\"variable\">$LD_CONF</span>/libwebp.conf <span class=\"variable\">$LD_CONF</span>/imagemagick.conf <span class=\"variable\">$LD_CONF</span>/giflib.conf <span class=\"variable\">$LD_CONF</span>/libpng.conf</span><br></pre></td></tr></table></figure>\n\n<p>通过该系统库，完美适配 <a href=\"https://github.com/kwanhur/lua-resty-imagick\">lua-resty-imagick</a> :)</p>\n","site":{"data":{}},"excerpt":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>对于喜欢折腾的人，安装所需系统库都是手工源码编译出来使用，这或许有种可控的感觉。</p>\n<p>相比直接使用软件库已编译好的，源码编译可更加自由选择或指定版本。</p>\n<p>近期在 CentOS-7.2 系统上，升级 webp 图片依赖系统库时，整理了个一键编译 ImageMagick 脚本，如下：</p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">head</span>  -n 1 /etc/redhat-release </span><br><span class=\"line\"></span><br><span class=\"line\">CentOS Linux release 7.2.1511 (Core) </span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">uname</span> -r</span><br><span class=\"line\">3.10.0-327.el7.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /export/svr /export/lib</span><br><span class=\"line\">DIR=/export/svr</span><br><span class=\"line\">PREFIX=/export/lib</span><br><span class=\"line\"></span><br><span class=\"line\">JPEG_VER=1.5.2</span><br><span class=\"line\">PNG_VER=1.6.34</span><br><span class=\"line\">GIF_VER=5.1.4</span><br><span class=\"line\">WEBP_VER=0.6.1</span><br><span class=\"line\">IMAGICK_VER=7.0.7-26</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/libjpeg-turbo/<span class=\"variable\">$JPEG_VER</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz -O <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/libpng/libpng16/<span class=\"variable\">$PNG_VER</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz -O <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://jaist.dl.sourceforge.net/project/giflib/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2 -O <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span>.tar.bz2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://codeload.github.com/webmproject/libwebp/tar.gz/v<span class=\"variable\">$WEBP_VER</span> -O <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$PREFIX</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span>.tar.gz ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  wget https://codeload.github.com/ImageMagick/ImageMagick/tar.gz/<span class=\"variable\">$IMAGICK_VER</span> -O <span class=\"variable\">$PREFIX</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span>.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$PREFIX</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -fr libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> libpng-<span class=\"variable\">$PNG_VER</span> giflib-<span class=\"variable\">$GIF_VER</span> libwebp-<span class=\"variable\">$WEBP_VER</span> ImageMagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#base package</span></span><br><span class=\"line\">yum install -y -q libtool libtool-ltdl libtool-ltdl-devel gcc make autoconf automake readline-devel nasm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libjpeg-turbo</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libjpeg-turbo</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> &amp;&amp; make -j24 &amp;&amp; make -j24 install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> <span class=\"variable\">$PREFIX</span>/libjpeg-turbo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libjpeg-turbo OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libjpeg-turbo failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib&quot;</span> &gt; /etc/ld.so.conf.d/jpeg-turbo.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libpng</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libpng</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libpng-<span class=\"variable\">$PNG_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> &amp;&amp; make -j24 &amp;&amp; make -j24 install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> <span class=\"variable\">$PREFIX</span>/libpng</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libpng OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libpng failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libpng/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libpng/lib&quot;</span> &gt; /etc/ld.so.conf.d/libpng.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#giflib</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/giflib</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -fr <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/giflib-<span class=\"variable\">$GIF_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> &amp;&amp; make -j24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> <span class=\"variable\">$PREFIX</span>/giflib </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status giflib OK&quot;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status giflib failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/giflib/lib&quot;</span> &gt; /etc/ld.so.conf.d/giflib.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#libwebp</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/libwebp-<span class=\"variable\">$WEBP_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null</span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/libwebp</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span></span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> --enable-everything --disable-tiff --disable-wic \\</span><br><span class=\"line\">--with-gifincludedir=<span class=\"variable\">$PREFIX</span>/giflib/include --with-giflibdir=<span class=\"variable\">$PREFIX</span>/giflib/lib \\</span><br><span class=\"line\">--with-jpegincludedir=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/include --with-jpeglibdir=<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib \\</span><br><span class=\"line\">--with-pngincludedir=<span class=\"variable\">$PREFIX</span>/libpng/include --with-pnglibdir=<span class=\"variable\">$PREFIX</span>/libpng/lib &amp;&amp; make -j24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> <span class=\"variable\">$PREFIX</span>/libwebp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libwebp OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status libwebp failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/libwebp/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/libwebp/lib&quot;</span> &gt; /etc/ld.so.conf.d/libwebp.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#webp support yes</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;DIR&#125;</span>/ImageMagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\"><span class=\"built_in\">unlink</span> <span class=\"variable\">$PREFIX</span>/imagemagick</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf <span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span></span><br><span class=\"line\">make clean &gt;/dev/null </span><br><span class=\"line\"><span class=\"built_in\">export</span> PKG_CONFIG=/usr/bin/pkg-config</span><br><span class=\"line\"><span class=\"built_in\">export</span> CPPFLAGS=<span class=\"string\">&quot;-I<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/include&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LDFLAGS=<span class=\"string\">&quot;-L<span class=\"variable\">$PREFIX</span>/libjpeg-turbo/lib&quot;</span></span><br><span class=\"line\">./configure --prefix=<span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span> --enable-static --enable-shared  --disable-docs  \\</span><br><span class=\"line\">--with-modules --with-webp=<span class=\"built_in\">yes</span> --disable-openmp --enable-delegate-build &amp;&amp; make -j 24 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -sfnv <span class=\"variable\">$PREFIX</span>/imagemagick-<span class=\"variable\">$IMAGICK_VER</span> <span class=\"variable\">$PREFIX</span>/imagemagick</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> $? -eq 0 &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status imagemagick OK&quot;</span>||<span class=\"built_in\">echo</span> <span class=\"string\">&quot;install_status imagemagick failed&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> -a <span class=\"variable\">$PREFIX</span>/imagemagick/lib/pkgconfig/*.pc /usr/lib64/pkgconfig/</span><br><span class=\"line\">sudo <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$PREFIX</span>/imagemagick/lib&quot;</span> &gt; /etc/ld.so.conf.d/imagemagick.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#pacakge imagemagick with dependent libraries</span></span><br><span class=\"line\">VERSION=7.0.7-26</span><br><span class=\"line\">LIB_PKG=/usr/lib64/pkgconfig</span><br><span class=\"line\">LD_CONF=/etc/ld.so.conf.d</span><br><span class=\"line\"></span><br><span class=\"line\">tar -jPcf imagemagick-<span class=\"variable\">$VERSION</span>.tar.bz2 <span class=\"variable\">$PREFIX</span>/imagemagick <span class=\"variable\">$PREFIX</span>/imagemagick-7.0.7-26 <span class=\"variable\">$PREFIX</span>/giflib \\</span><br><span class=\"line\"><span class=\"variable\">$PREFIX</span>/giflib-<span class=\"variable\">$GIF_VER</span> <span class=\"variable\">$PREFIX</span>/libpng <span class=\"variable\">$PREFIX</span>/libpng-<span class=\"variable\">$PNG_VER</span> <span class=\"variable\">$PREFIX</span>/libwebp <span class=\"variable\">$PREFIX</span>/libwebp-<span class=\"variable\">$WEBP_VER</span> \\</span><br><span class=\"line\"><span class=\"variable\">$PREFIX</span>/libjpeg-turbo <span class=\"variable\">$PREFIX</span>/libjpeg-turbo-<span class=\"variable\">$JPEG_VER</span> \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/ImageMagick-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/ImageMagick.pc <span class=\"variable\">$LIB_PKG</span>/Magick++-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/MagickCore-7.Q16HDRI.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/MagickCore.pc <span class=\"variable\">$LIB_PKG</span>/Magick++.pc <span class=\"variable\">$LIB_PKG</span>/MagickWand-7.Q16HDRI.pc <span class=\"variable\">$LIB_PKG</span>/MagickWand.pc <span class=\"variable\">$LIB_PKG</span>/libwebpdecoder.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LIB_PKG</span>/libwebpdemux.pc <span class=\"variable\">$LIB_PKG</span>/libwebpmux.pc <span class=\"variable\">$LIB_PKG</span>/libwebp.pc <span class=\"variable\">$LIB_PKG</span>/libjpeg.pc <span class=\"variable\">$LIB_PKG</span>/libturbojpeg.pc \\</span><br><span class=\"line\"><span class=\"variable\">$LD_CONF</span>/jpeg-turbo.conf <span class=\"variable\">$LD_CONF</span>/libwebp.conf <span class=\"variable\">$LD_CONF</span>/imagemagick.conf <span class=\"variable\">$LD_CONF</span>/giflib.conf <span class=\"variable\">$LD_CONF</span>/libpng.conf</span><br></pre></td></tr></table></figure>\n\n<p>通过该系统库，完美适配 <a href=\"https://github.com/kwanhur/lua-resty-imagick\">lua-resty-imagick</a> :)</p>"},{"title":"nginx-http2-grpc","date":"2018-03-23T08:43:36.000Z","_content":"\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\nNGINX 官方已发布 [1.13.10](http://nginx.org/en/CHANGES) 版本，其最主要更新功能点莫过于支持 gRPC 服务代理，即新增的模块 [ngx_http_grpc_module](http://nginx.org/en/docs/http/ngx_http_grpc_module.html)。\n\n这意味着可以很容易复用 Nginx 现有基础设施，简单几步即可构建出高可用的 gRPC 服务端集群，具体构建概要如下：\n\n<!--more-->\n\n> 搭建 go-grpc 服务，参见 [https://grpc.io/docs/quickstart/go.html](https://grpc.io/docs/quickstart/go.html)\n\n```bash\n$ cd $GOPATH/src/google.golang.org/grpc/examples/helloworld\n\n#启动服务端，默认端口 50051\n$ go run greeter_server/main.go\n\n#测试客户端\n$ go run greeter_client/main.go\n\n#交互成功可见输出结果\nGreeting: Hello world\n```\n\n> 搭建 nginx-grpc 代理\n>> nginx 构建支持 http2+grpc\n\n```bash\n$ wget http://nginx.org/download/nginx-1.13.10.tar.gz -O /tmp/nginx-1.13.10.tar.gz\n\n$ cd /tmp && tar xzf nginx-1.13.10.tar.gz && cd nginx-1.13.10\n\n$ ./configure --with-http_ssl_module --with-http_v2_module && make -j4 && make install && /usr/local/nginx/sbin/nginx -V\n```\n\n>> 配置 nginx 支持 grpc 代理\n\n```\n#vhosts/grpc.conf 配置 demo 文件\nupstream grpc.server{\n    server 127.0.0.1:50051;\n}\n\nserver {\n    listen 80 http2;\n    access_log grpc.access.log main;\n        \n    location / {\n        grpc_pass grpc.server;\n    }\n}\n```\n\n>> 从上述简单的配置可看出，grpc 模块可以和 upstream 模块结合使用，这意味着可复用 upstream 模块 [高可用配置](http://nginx.org/en/docs/http/ngx_http_upstream_module.html),\n当然，grpc 模块也提供类似配置，如 [grpc_next_upstream](http://nginx.org/en/docs/http/ngx_http_grpc_module.html#grpc_next_upstream) 等。\n>>\n> 验证 nginx-grpc 代理\n>> 启动 nginx 代理服务\n\n```bash\n$ sudo /usr/local/nginx/sbin/nginx -t && sudo /usr/local/nginx/sbin/nginx\n```\n\n> grpc 服务测验\n\n```bash\n$ cd $GOPATH/src/google.golang.org/grpc/examples/helloworld\n\n#！注意修改客户端连接服务端口为 80\n$ go run greeter_client/main.go\n\n#交互成功可见输出结果\nGreeting: Hello world\n#nginx 访问日志可见输出\n127.0.0.1 - - [23/Mar/2018:17:21:10 +0800] \"POST /helloworld.Greeter/SayHello HTTP/2.0\" 200 18 \"-\" \"grpc-go/1.11.0-dev\" \"-\"\n```\n\n总体可见，通过 nginx 可以很轻松的构建出高可用的 grpc 服务代理。\n","source":"_posts/nginx-http2-grpc.md","raw":"---\ntitle: nginx-http2-grpc\ndate: 2018-03-23 16:43:36\ntags:\n    - nginx\n    - http2\n    - grpc\n---\n\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\nNGINX 官方已发布 [1.13.10](http://nginx.org/en/CHANGES) 版本，其最主要更新功能点莫过于支持 gRPC 服务代理，即新增的模块 [ngx_http_grpc_module](http://nginx.org/en/docs/http/ngx_http_grpc_module.html)。\n\n这意味着可以很容易复用 Nginx 现有基础设施，简单几步即可构建出高可用的 gRPC 服务端集群，具体构建概要如下：\n\n<!--more-->\n\n> 搭建 go-grpc 服务，参见 [https://grpc.io/docs/quickstart/go.html](https://grpc.io/docs/quickstart/go.html)\n\n```bash\n$ cd $GOPATH/src/google.golang.org/grpc/examples/helloworld\n\n#启动服务端，默认端口 50051\n$ go run greeter_server/main.go\n\n#测试客户端\n$ go run greeter_client/main.go\n\n#交互成功可见输出结果\nGreeting: Hello world\n```\n\n> 搭建 nginx-grpc 代理\n>> nginx 构建支持 http2+grpc\n\n```bash\n$ wget http://nginx.org/download/nginx-1.13.10.tar.gz -O /tmp/nginx-1.13.10.tar.gz\n\n$ cd /tmp && tar xzf nginx-1.13.10.tar.gz && cd nginx-1.13.10\n\n$ ./configure --with-http_ssl_module --with-http_v2_module && make -j4 && make install && /usr/local/nginx/sbin/nginx -V\n```\n\n>> 配置 nginx 支持 grpc 代理\n\n```\n#vhosts/grpc.conf 配置 demo 文件\nupstream grpc.server{\n    server 127.0.0.1:50051;\n}\n\nserver {\n    listen 80 http2;\n    access_log grpc.access.log main;\n        \n    location / {\n        grpc_pass grpc.server;\n    }\n}\n```\n\n>> 从上述简单的配置可看出，grpc 模块可以和 upstream 模块结合使用，这意味着可复用 upstream 模块 [高可用配置](http://nginx.org/en/docs/http/ngx_http_upstream_module.html),\n当然，grpc 模块也提供类似配置，如 [grpc_next_upstream](http://nginx.org/en/docs/http/ngx_http_grpc_module.html#grpc_next_upstream) 等。\n>>\n> 验证 nginx-grpc 代理\n>> 启动 nginx 代理服务\n\n```bash\n$ sudo /usr/local/nginx/sbin/nginx -t && sudo /usr/local/nginx/sbin/nginx\n```\n\n> grpc 服务测验\n\n```bash\n$ cd $GOPATH/src/google.golang.org/grpc/examples/helloworld\n\n#！注意修改客户端连接服务端口为 80\n$ go run greeter_client/main.go\n\n#交互成功可见输出结果\nGreeting: Hello world\n#nginx 访问日志可见输出\n127.0.0.1 - - [23/Mar/2018:17:21:10 +0800] \"POST /helloworld.Greeter/SayHello HTTP/2.0\" 200 18 \"-\" \"grpc-go/1.11.0-dev\" \"-\"\n```\n\n总体可见，通过 nginx 可以很轻松的构建出高可用的 grpc 服务代理。\n","slug":"nginx-http2-grpc","published":1,"updated":"2022-04-17T11:51:51.399Z","_id":"cl1sruq6y0003qlvh136x4izu","comments":1,"layout":"post","photos":[],"link":"","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>NGINX 官方已发布<a href=\"http://nginx.org/en/CHANGES\">1.13.10</a>版本，其最主要更新功能点莫过于支持 gRPC 服务代理，即新增的模块<a href=\"http://nginx.org/en/docs/http/ngx_http_grpc_module.html\">ngx_http_grpc_module</a>。</p>\n<p>这意味着可以很容易复用 Nginx 现有基础设施，简单几步即可构建出高可用的 gRPC 服务端集群，具体构建概要如下：</p>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>搭建 go-grpc 服务，参见 <a href=\"https://grpc.io/docs/quickstart/go.html\">https://grpc.io/docs/quickstart/go.html</a></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> <span class=\"variable\">$GOPATH</span>/src/google.golang.org/grpc/examples/helloworld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动服务端，默认端口 50051</span></span><br><span class=\"line\">$ go run greeter_server/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#测试客户端</span></span><br><span class=\"line\">$ go run greeter_client/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交互成功可见输出结果</span></span><br><span class=\"line\">Greeting: Hello world</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>搭建 nginx-grpc 代理</p>\n<blockquote>\n<p>nginx 构建支持 http2+grpc</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ wget http://nginx.org/download/nginx-1.13.10.tar.gz -O /tmp/nginx-1.13.10.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> /tmp &amp;&amp; tar xzf nginx-1.13.10.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> nginx-1.13.10</span><br><span class=\"line\"></span><br><span class=\"line\">$ ./configure --with-http_ssl_module --with-http_v2_module &amp;&amp; make -j4 &amp;&amp; make install &amp;&amp; /usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<blockquote>\n<p>配置 nginx 支持 grpc 代理</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#vhosts/grpc.conf 配置 demo 文件</span><br><span class=\"line\">upstream grpc.server&#123;</span><br><span class=\"line\">    server 127.0.0.1:50051;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80 http2;</span><br><span class=\"line\">    access_log grpc.access.log main;</span><br><span class=\"line\">        </span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        grpc_pass grpc.server;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<blockquote>\n<p>从上述简单的配置可看出，grpc 模块可以和 upstream 模块结合使用，这意味着可复用 upstream 模块<a href=\"http://nginx.org/en/docs/http/ngx_http_upstream_module.html\">高可用配置</a>,<br>当然，grpc 模块也提供类似配置，如<a href=\"http://nginx.org/en/docs/http/ngx_http_grpc_module.html#grpc_next_upstream\">grpc_next_upstream</a>等。</p>\n</blockquote>\n<p>验证 nginx-grpc 代理</p>\n<blockquote>\n<p>启动 nginx 代理服务</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo /usr/local/nginx/sbin/nginx -t &amp;&amp; sudo /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>grpc 服务测验</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> <span class=\"variable\">$GOPATH</span>/src/google.golang.org/grpc/examples/helloworld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#！注意修改客户端连接服务端口为 80</span></span><br><span class=\"line\">$ go run greeter_client/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交互成功可见输出结果</span></span><br><span class=\"line\">Greeting: Hello world</span><br><span class=\"line\"><span class=\"comment\">#nginx 访问日志可见输出</span></span><br><span class=\"line\">127.0.0.1 - - [23/Mar/2018:17:21:10 +0800] <span class=\"string\">&quot;POST /helloworld.Greeter/SayHello HTTP/2.0&quot;</span> 200 18 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;grpc-go/1.11.0-dev&quot;</span> <span class=\"string\">&quot;-&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>总体可见，通过 nginx 可以很轻松的构建出高可用的 grpc 服务代理。</p>\n","site":{"data":{}},"excerpt":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>NGINX 官方已发布<a href=\"http://nginx.org/en/CHANGES\">1.13.10</a>版本，其最主要更新功能点莫过于支持 gRPC 服务代理，即新增的模块<a href=\"http://nginx.org/en/docs/http/ngx_http_grpc_module.html\">ngx_http_grpc_module</a>。</p>\n<p>这意味着可以很容易复用 Nginx 现有基础设施，简单几步即可构建出高可用的 gRPC 服务端集群，具体构建概要如下：</p>","more":"<blockquote>\n<p>搭建 go-grpc 服务，参见 <a href=\"https://grpc.io/docs/quickstart/go.html\">https://grpc.io/docs/quickstart/go.html</a></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> <span class=\"variable\">$GOPATH</span>/src/google.golang.org/grpc/examples/helloworld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动服务端，默认端口 50051</span></span><br><span class=\"line\">$ go run greeter_server/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#测试客户端</span></span><br><span class=\"line\">$ go run greeter_client/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交互成功可见输出结果</span></span><br><span class=\"line\">Greeting: Hello world</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>搭建 nginx-grpc 代理</p>\n<blockquote>\n<p>nginx 构建支持 http2+grpc</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ wget http://nginx.org/download/nginx-1.13.10.tar.gz -O /tmp/nginx-1.13.10.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> /tmp &amp;&amp; tar xzf nginx-1.13.10.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> nginx-1.13.10</span><br><span class=\"line\"></span><br><span class=\"line\">$ ./configure --with-http_ssl_module --with-http_v2_module &amp;&amp; make -j4 &amp;&amp; make install &amp;&amp; /usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<blockquote>\n<p>配置 nginx 支持 grpc 代理</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#vhosts/grpc.conf 配置 demo 文件</span><br><span class=\"line\">upstream grpc.server&#123;</span><br><span class=\"line\">    server 127.0.0.1:50051;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80 http2;</span><br><span class=\"line\">    access_log grpc.access.log main;</span><br><span class=\"line\">        </span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        grpc_pass grpc.server;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<blockquote>\n<p>从上述简单的配置可看出，grpc 模块可以和 upstream 模块结合使用，这意味着可复用 upstream 模块<a href=\"http://nginx.org/en/docs/http/ngx_http_upstream_module.html\">高可用配置</a>,<br>当然，grpc 模块也提供类似配置，如<a href=\"http://nginx.org/en/docs/http/ngx_http_grpc_module.html#grpc_next_upstream\">grpc_next_upstream</a>等。</p>\n</blockquote>\n<p>验证 nginx-grpc 代理</p>\n<blockquote>\n<p>启动 nginx 代理服务</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo /usr/local/nginx/sbin/nginx -t &amp;&amp; sudo /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>grpc 服务测验</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> <span class=\"variable\">$GOPATH</span>/src/google.golang.org/grpc/examples/helloworld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#！注意修改客户端连接服务端口为 80</span></span><br><span class=\"line\">$ go run greeter_client/main.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交互成功可见输出结果</span></span><br><span class=\"line\">Greeting: Hello world</span><br><span class=\"line\"><span class=\"comment\">#nginx 访问日志可见输出</span></span><br><span class=\"line\">127.0.0.1 - - [23/Mar/2018:17:21:10 +0800] <span class=\"string\">&quot;POST /helloworld.Greeter/SayHello HTTP/2.0&quot;</span> 200 18 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;grpc-go/1.11.0-dev&quot;</span> <span class=\"string\">&quot;-&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>总体可见，通过 nginx 可以很轻松的构建出高可用的 grpc 服务代理。</p>"},{"title":"pick-up-blog","date":"2022-04-10T09:27:49.000Z","_content":"\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n该博客被遗弃很久了，近期看到 `NexT` 主题比较合心意，决定折腾下，更换了主题，看到的效果还不错。\n\n另一原因是，之前写的分享内容全部在公司内部`wiki`系统，离开后也就留下了；所以决定后续关于技术研究、想法点子等采用`Github Pages`形式分享。\n\n<!--more-->\n\n折腾过程还是遇到点小麻烦：本地预览没问题，发布推送上`Github`后，样式错乱，即使禁用浏览器缓存也不起作用。\n\n经一番翻查，对比样式文件`css/main.css`本地与`Github`请求响应体大小不一致。\n\n手动触发请求`https://$repo.github.io/css/main.css`随即解决。\n\n原因猜测：旧主题所用的样式文件一直被服务器端缓存，经`hexo deploy`推送至`Github`，但`Github Pages`服务并不会更新静态文件缓存。\n","source":"_posts/pick-up-blog.md","raw":"---\n\ntitle: pick-up-blog\ndate: 2022-04-10 17:27:49\ntags:\n    - journal\n---\n\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n该博客被遗弃很久了，近期看到 `NexT` 主题比较合心意，决定折腾下，更换了主题，看到的效果还不错。\n\n另一原因是，之前写的分享内容全部在公司内部`wiki`系统，离开后也就留下了；所以决定后续关于技术研究、想法点子等采用`Github Pages`形式分享。\n\n<!--more-->\n\n折腾过程还是遇到点小麻烦：本地预览没问题，发布推送上`Github`后，样式错乱，即使禁用浏览器缓存也不起作用。\n\n经一番翻查，对比样式文件`css/main.css`本地与`Github`请求响应体大小不一致。\n\n手动触发请求`https://$repo.github.io/css/main.css`随即解决。\n\n原因猜测：旧主题所用的样式文件一直被服务器端缓存，经`hexo deploy`推送至`Github`，但`Github Pages`服务并不会更新静态文件缓存。\n","slug":"pick-up-blog","published":1,"updated":"2022-04-17T11:47:55.955Z","_id":"cl1t3vblg0000xjvhhula3lu3","comments":1,"layout":"post","photos":[],"link":"","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>该博客被遗弃很久了，近期看到 <code>NexT</code> 主题比较合心意，决定折腾下，更换了主题，看到的效果还不错。</p>\n<p>另一原因是，之前写的分享内容全部在公司内部<code>wiki</code>系统，离开后也就留下了；所以决定后续关于技术研究、想法点子等采用<code>Github Pages</code>形式分享。</p>\n<span id=\"more\"></span>\n\n<p>折腾过程还是遇到点小麻烦：本地预览没问题，发布推送上<code>Github</code>后，样式错乱，即使禁用浏览器缓存也不起作用。</p>\n<p>经一番翻查，对比样式文件<code>css/main.css</code>本地与<code>Github</code>请求响应体大小不一致。</p>\n<p>手动触发请求<code>https://$repo.github.io/css/main.css</code>随即解决。</p>\n<p>原因猜测：旧主题所用的样式文件一直被服务器端缓存，经<code>hexo deploy</code>推送至<code>Github</code>，但<code>Github Pages</code>服务并不会更新静态文件缓存。</p>\n","site":{"data":{}},"excerpt":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<p>该博客被遗弃很久了，近期看到 <code>NexT</code> 主题比较合心意，决定折腾下，更换了主题，看到的效果还不错。</p>\n<p>另一原因是，之前写的分享内容全部在公司内部<code>wiki</code>系统，离开后也就留下了；所以决定后续关于技术研究、想法点子等采用<code>Github Pages</code>形式分享。</p>","more":"<p>折腾过程还是遇到点小麻烦：本地预览没问题，发布推送上<code>Github</code>后，样式错乱，即使禁用浏览器缓存也不起作用。</p>\n<p>经一番翻查，对比样式文件<code>css/main.css</code>本地与<code>Github</code>请求响应体大小不一致。</p>\n<p>手动触发请求<code>https://$repo.github.io/css/main.css</code>随即解决。</p>\n<p>原因猜测：旧主题所用的样式文件一直被服务器端缓存，经<code>hexo deploy</code>推送至<code>Github</code>，但<code>Github Pages</code>服务并不会更新静态文件缓存。</p>"},{"title":"OpenStack 系列（架构篇 1）- 企业需求","date":"2022-04-15T13:04:39.000Z","_content":"\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n> 前言：个人看法，学习一门技术，先从整体架构视角去了解，让自己有个总体概念。带着问题去查阅官方文档，技术路线会更加清晰，比如它为什么会出现（背景）、帮助谁解决什么样的问题（场景）、如何解决的（方式）、设计思路是什么（架构）。\n>\n> 本篇文章内容翻译自 OpenStack 官网 [^1]。\n\n总的看，从 13 个方面来考虑影响基于 OpenStack 构建的云设施。分别是：\n\n<!--more-->\n\n1. 成本\n2. 上市耗时\n3. 机遇收益\n4. 容量规划与扩展\n5. 性能\n6. 网络\n7. 规约与地理位置\n8. 审计\n9. 安全\n10. 服务承诺\n11. 应用就绪状态\n12. 认证\n13. 迁移，可用性，站点损失及恢复\n\n<!--more-->\n\n​    对于任何一个组织，财务都是主要考虑的因素。成本的考虑会很大程度上影响你所能构建成什么类型的云平台。在选择或者设计云平台时，成本不应该成为制约因素。\n\n​    作为一份通用指引，云平台架构复杂性的增加，构建和维护的成本也会同步增加。比如，一朵混合或多站点部署的云架构，涵盖了多供应商和多种技术架构，就可能需要投入更高的安装和运维成本；因为相比其他架构，它需要更先进的编排系统和易用的工具集。\n\n​    设计一套云平台，通常会考虑以下成本目录：\n\n- 计算资源\n- 网络资源\n- 平台副本\n- 存储资源\n- 平台管理\n- 运维成本\n\n​    云平台扩展时所需的成本，需要重点考虑。同时，整体建设成本最小化也是比较重要的。运维海量可扩展的 OpenStack 云平台时，使用商业硬件和自由可用的开源软件组件，有助于降低部署成本和运维投入，可参考 [Open Compute](http://www.opencompute.org/) 提供的额外信息。\n\n## 上市耗时\n\n​    构建云平台时，是否具备相对稳定的服务或产品发布耗时能力，是常见的商业因素。让用户自助按需获得计算、网络、存储资源，可能帮助到他们的产品或者应用减少投产上市的时间。\n\n​    你需要权衡构建云平台和迁移用户上云的耗时。在某些场景下，现有的基础设施会影响他们的架构选型。比如，对于一个已有的投资系统（内含多个应用），使用多云平台可能会是一个更优选项，毕竟它能快速地将各组件串联在一起而不是全部重构上到一套云平台。\n\n## 机遇收益\n\n​    机遇收益很大程度上受制于云平台的意图和用户案例。商业需求、客户面临的产品都会不同程度上影响到一套内部的、私有的云平台。你一定要考虑云平台具备哪些功能特性，来吸引你的用户。\n\n## 容量规划与扩展\n\n​    容量和工作负载的布置是云平台的关键设计因素。长期的容量规划必定满足随时间推移的增长需求，避免资源耗尽的情况。\n\n​    预测特定应用工作负载是比较困难的，因为它受用户量、应用成熟度等因素影响。定义出应用需求还是很有可能的，比如 vCPU，RAM，bandwidth，及其他资源。不同云平台可能使用不同的度量维度，甚至会有不同的超售配额。\n\n​    超售配额是一种虚拟化出比物理资源更多大容量的方式。例如，一台 32 GB RAM 物理节点可能承载着 24 个 2 GB RAM 主机实例。这 24 个实例并不会同时都使用 2 GB RAM，这种超售方案能很好工作。但是，某些主机消耗超过了资源极限，最终会产生不符合预期的性能表现。固然是需要根据容量规划来设计超售配比。\n\n## 性能\n\n​    设计任何一套云平台，性能都是核心考虑因素。随着规模和复杂度的提升，性能越显突出。单站点、私有云基本是可控的，多站点和混合部署则需要更多关注规划来减少问题，比如站点间的延迟。\n\n​    例如，你应该考虑各种方法来降低不同云平台间的工作负载耗时。这可能需要将数据搬得离应用更近些，或者将应用更靠近数据的地方以及功能化分组，最终在单套云平台内获得更低延迟的连接，甚至在多套云平台间。\n\n​    这样可能需要一套 CMP 云管平台来协助决策哪些云资源适合哪些类的工作负载。\n\n​    使用原生的 OpenStack 工具集能够帮助提升性能。比如，你可以使用遥测来衡量性能以及编排服务（心跳），以应对按需带来的变化。\n\n### 云资源部署\n\n​    云平台用户期望拥有可重叠的、可依赖的以及确定的进程来拉起和部署云资源。你应该通过基于 web 界面接口或者公共可用的 API 端点来发布这些资源。所有请求云资源的可能选项都必需通过某种用户接口、命令式接口（CLI）或者 API 端点来启用。\n\n### 消费模型\n\n​    云平台用户期望一种完全自助、按需获取的消费模型。当一个 OpenStack 云平台满足了海量可伸缩的资源诉求，能轻松应对该种消费模型。\n\n- 一切必需自动化。例如，所有的计算硬件、存储硬件、网络硬件，采用某种可支持的软件来进行安装及配置。手动操作对构建海量可伸缩的 OpenStack 设计架构是不切实际的。\n- 海量可伸缩的 OpenStack 云平台需要配齐可扩展的度量和监控功能来最大化运维效率，通过保持知悉这些基础设施的状态信息。这就包括了全部硬件和软件的状态度量。一套同类的日志和告警功能需同样配备，用于存储和开启这些有度量和监控方案提供的度量指标。云平台运维者需要知道度量和监控方案提供的数据用于规划容量和容量趋势分析。\n\n### 位置\n\n​    对于许多用户使用场景，他们的应用性能受到工作负载的直接影响，所以在设计时应该考虑到。特定的应用通过部署在多位置的云平台，有可能获取接近零延迟。这些位置可能分布在不同的数据中心、城市、国家或者地理区域，取决于用户需求及用户所在位置。\n\n### I/O 需求\n\n​    I/O 性能需求需在决定一个最终存储框架前完成调研和建模。运行基准测试来提供预期的性能水平基线。如果这些测试包含了许多细节，最终数据能更有利于建模和评估不同的工作负载。在整个架构生命周期内，运行脚本化的小基准测试能及时记录系统健康度。这些来自脚本化基准测试的数据，在未来能帮助限定和深入理解一个组织的需求。\n\n### 伸缩\n\n​    在关注存储方面，OpenStack 架构设计可伸缩存储方案是由最初的需求驱动的，包括了 IOPS，容量，带宽以及未来需求。基于项目的容量规划，需要覆盖全程的消耗，在设计时是非常重要的。该架构应该平衡成本和容量，在两者间通过新技术和方法来满足灵活性要求。\n\n## 网络\n\n​    考虑网络的功能性、安全性、可伸缩性、可用性和可测试性是非常重要的，特别是在选择一套 CMP 平台及一家云厂商的时候。\n\n- 依赖于网络框架和设计最小功能测试用例。在升级期间或之后，这能确保测试和功能的完整性。\n- 可伸缩性涵盖多云厂商可能限定的底层网络框架，尤其在选择不同云厂商时。提供网络 API 接口功能及用于验证功能完整性，特别是选择了跨多云端点，就显得尤为重要。\n- 高可用在功能实现和设计时，都需要考虑到。常见的模式主 - 热备、主备和主主。高可用的开发和测试框架，对于保证功能和条约是非常有必要的。\n- 考虑数据在客户端和端点、不同云平台间传输流量的安全性。\n\n​    例如，视频流延迟和低质量的 VoIP 通话就会较大影响用户体验，潜在可能导致产品和经济的损失。\n\n### 网络误配置\n\n​    配置了不正确的 IP 地址、VLAN 号和路由器，都有可能引起大范围的网络故障，极端情况下，影响整套基础设施。自动化的网络配置能极小化这种运维错误的几率而导致灾难性的事故。\n\n### 容量规划\n\n​    云网络需要对容量进行管理和及时的扩充。容量规划包括了网络设备购买和硬件潜在长达数月/年的中断。\n\n### 网络调优\n\n​    配置云网络需要最小化链路缺失、丢包、包风暴、广播风暴及环路。\n\n### 单点故障\n\n​    在物理和各种环境，都要考虑高可用。如果存在单故障点，比如单个上游连接、单电源供电，都会导致无法避免的故障。\n\n### 复杂度\n\n​    一份过于复杂的网络设计，会难以运维及问题定位。在设备层面配置要易于维护，能用自动化工具处理覆盖式网络，在功能和特定设备上，通过避免或者记录下非传统式的交汇点，进而规避故障。\n\n### 非标准特性\n\n​    通过配置云厂商网络来获得厂商的特定特性，这是比较冒险的。例如 MLAG 多链接聚合模式，用来在网络交换聚合器中提供冗余度。MLAG 不是一份标准，结果不同厂商都有自己的实现逻辑。MLAG 架构是不适合于跨多交换机厂商的，它会导致被厂商锁定，以及组件升级延迟甚至不可用等。\n\n### 动态资源扩张或突发\n\n​    一个应用需要额外的资源来满足多云架构。例如，零售商只是在假期需要额外的资源，但不想再添加其他的云资源来应对需求洪峰。这些用户额外带来的突增负载，在这期间，可在公共云资源上来对应。这些突增的时间，有可能长达数小时到年不等。\n\n## 规约与地理位置\n\n​    一个组织可能有明确的法律义务和正规规约来评估哪些明确的工作负载或数据不能被落地到指定的区域。\n\n​    对于多站点的云平台，规约要素是相当重要的，包括：\n\n- 联邦法律需求\n- 本地司法法律和规约需求\n- 镜像一致性和可用性\n- 存储副本和可用性（包括块存储和文件/对象存储）\n- 认证、授权和审计（AAA）\n\n​    地理因素可能同样影响数据中心构建/租赁成本，包括：\n\n- 楼宇空间\n- 楼宇承重\n- 机柜高度和类型\n- 环境因素\n- 电力使用和电力使用有效性\n- 物理安全性\n\n## 审计\n\n​    一个全方位的审计计划，对于快速排查问题是非常关键的。持续跟踪安全组的变化和租户的变化，在生产环境对于需要回滚变更是很有用的。比如，如果某个租户的所有安全组规则消失了，迅速跟踪出该问题的能力，对于运维和合理性解释是非常的重要。\n\n## 安全\n\n​    各类型组织使用云平台有着不同级别的安全需求。例如，政府和金融机构通常由非常高的安全需求。安全应当依据资产、威胁和漏洞风险等多方位来保障。\n\n## 服务承诺\n\n​    SLA 是一定涵括在商业、技术和法律里。小的、私有的云平台可能是包含一份简单 SLA，但混合或者公有云平台通常会有多份正式协议书给到用户。\n\n​    对于一个海量可伸缩的 OpenStack 公有云平台用户，对于掌控安全、性能或可用性是没有多少期望。用户只关注 API 服务运行时长 SLA、基本的服务 SLA。用户根据职责来定位这些他们关心的议题。对于公有云设施，超出预期的是非常的罕见，构建私有或政府机构的则会有明确的清单。\n\n​    搞性能系统会有 SLA 清单说明最低等级的服务质量，涵盖保证运行时长、延迟和带宽。SLA 等级更多会受网络架构和系统冗余度需求的影响。\n\n​    混合云的 SLA 一定要满足厂商的能力和权力范围的差异。\n\n## 应用就绪状态\n\n​    有些应用是能容忍对象存储同步缺失的，但其他则需要这些对象副本并在各区域可用。理解这些云资源实现逻辑如何影响新建、或存量的应用，对于风险迁移、成功上云都是很重要的。应用可能需要重写来适配无冗余的基础设施或云平台。\n\n### 应用压力\n\n​    存量应用的业务，可能会发现，相比迁移到一套云平台，集成到多套云平台会更加艰难。\n\n### 非预期使用模型\n\n​    缺失预定义使用模型，会让用户不知如何为各种应用评估需求。它可以提供应用所需的独立程度和灵活性，这些不是其他非云平台场景下能提供的。\n\n### 按需和自助式应用\n\n​    云平台提供终端用户能通过简单灵活的方式去按需获取计算、存储、网络和软件资源。用户能够扩展资源来提升服务质量，避免受到底层操作影响。使用通用型云平台架构收益之一，就是有能力从最初有限资源开始按需扩展资源应对增长诉求。\n\n## 认证\n\n​    比较推荐采用集中式认证服务，而不是每个站点都实现一套。这就要求认证机制是高可用且支持分布式的。认证服务器定位就应该提前做好设计。\n\n## 迁移，可用性，站点损失及恢复\n\n​    故障都可能会导致部分或全部站点功能不可用。提前制定策略来应对这些场景：\n\n- 部署的应用需能够持续提供服务，站点不可用一定要考虑带来的性能和应用可靠性影响。\n- 站点故障时，弄清楚各种对象和数据副本发生了什么是很重要的。如果产生了队列阻塞，需要评估这些阻塞会持续多久就会导致系统错误。\n- 故障过后，确保能找到正确的方法来应对下一次同样的出现。我们建议你从架构上恢复策略而避免各种竞态条件。\n\n### 灾难恢复与业务持续性\n\n​    更加偏移的存储策略能让公有云找到合适的备份策略。\n\n### 迁移场景\n\n​    混合云架构能让应用在不同云平台间迁移。\n\n### 厂商可用性或实现细节\n\n​    业务变更能影响厂商的可用性。比如，服务变更就可能中断一个混合云的环境或者增加成本。\n\n### 厂商 API 变更\n\n​    依赖外部云厂商服务，难以控制厂商不去变更 API，变更可能会破坏兼容性。尽量使用通用的 API 来尽可能减少潜在的冲突。\n\n### 镜像插拔\n\n​    就像 Kilo 版本发布一样，没有一个通用镜像格式适用于所有的云平台。在不同云平台间迁移，需要提前协商好镜像格式。为了简化部署，使用最小化和最简单的镜像，只安装那些必需的组件，使用部署管理器（如 Chef、Puppet）。别为了加速处理而使用笨重的镜像，除非你是在同一云平台上部署这些镜像。\n\n### API 差异\n\n​    避免使用不仅仅只是 OpenStack 或者带有不同版本 OpenStack 的混合云平台，就像 API 变更一样会带来兼容性问题。\n\n### 业务或技术多样性\n\n​    许多组织根据业务多样性，使用多厂商的混合云平台方案来分摊这些工作负载。这能保证应用的主机资源不被厂商锁定。\n\n[^1]:https://docs.openstack.org/arch-design/arch-requirements/arch-requirements-enterprise.html\n","source":"_posts/openstack-arch-enterprise-requirements.md","raw":"---\n\ntitle: OpenStack 系列（架构篇 1）- 企业需求\ndate: 2022-04-15 21:04:39\ntags:\n    - openstack\n    - arch\n---\n\n<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n> 前言：个人看法，学习一门技术，先从整体架构视角去了解，让自己有个总体概念。带着问题去查阅官方文档，技术路线会更加清晰，比如它为什么会出现（背景）、帮助谁解决什么样的问题（场景）、如何解决的（方式）、设计思路是什么（架构）。\n>\n> 本篇文章内容翻译自 OpenStack 官网 [^1]。\n\n总的看，从 13 个方面来考虑影响基于 OpenStack 构建的云设施。分别是：\n\n<!--more-->\n\n1. 成本\n2. 上市耗时\n3. 机遇收益\n4. 容量规划与扩展\n5. 性能\n6. 网络\n7. 规约与地理位置\n8. 审计\n9. 安全\n10. 服务承诺\n11. 应用就绪状态\n12. 认证\n13. 迁移，可用性，站点损失及恢复\n\n<!--more-->\n\n​    对于任何一个组织，财务都是主要考虑的因素。成本的考虑会很大程度上影响你所能构建成什么类型的云平台。在选择或者设计云平台时，成本不应该成为制约因素。\n\n​    作为一份通用指引，云平台架构复杂性的增加，构建和维护的成本也会同步增加。比如，一朵混合或多站点部署的云架构，涵盖了多供应商和多种技术架构，就可能需要投入更高的安装和运维成本；因为相比其他架构，它需要更先进的编排系统和易用的工具集。\n\n​    设计一套云平台，通常会考虑以下成本目录：\n\n- 计算资源\n- 网络资源\n- 平台副本\n- 存储资源\n- 平台管理\n- 运维成本\n\n​    云平台扩展时所需的成本，需要重点考虑。同时，整体建设成本最小化也是比较重要的。运维海量可扩展的 OpenStack 云平台时，使用商业硬件和自由可用的开源软件组件，有助于降低部署成本和运维投入，可参考 [Open Compute](http://www.opencompute.org/) 提供的额外信息。\n\n## 上市耗时\n\n​    构建云平台时，是否具备相对稳定的服务或产品发布耗时能力，是常见的商业因素。让用户自助按需获得计算、网络、存储资源，可能帮助到他们的产品或者应用减少投产上市的时间。\n\n​    你需要权衡构建云平台和迁移用户上云的耗时。在某些场景下，现有的基础设施会影响他们的架构选型。比如，对于一个已有的投资系统（内含多个应用），使用多云平台可能会是一个更优选项，毕竟它能快速地将各组件串联在一起而不是全部重构上到一套云平台。\n\n## 机遇收益\n\n​    机遇收益很大程度上受制于云平台的意图和用户案例。商业需求、客户面临的产品都会不同程度上影响到一套内部的、私有的云平台。你一定要考虑云平台具备哪些功能特性，来吸引你的用户。\n\n## 容量规划与扩展\n\n​    容量和工作负载的布置是云平台的关键设计因素。长期的容量规划必定满足随时间推移的增长需求，避免资源耗尽的情况。\n\n​    预测特定应用工作负载是比较困难的，因为它受用户量、应用成熟度等因素影响。定义出应用需求还是很有可能的，比如 vCPU，RAM，bandwidth，及其他资源。不同云平台可能使用不同的度量维度，甚至会有不同的超售配额。\n\n​    超售配额是一种虚拟化出比物理资源更多大容量的方式。例如，一台 32 GB RAM 物理节点可能承载着 24 个 2 GB RAM 主机实例。这 24 个实例并不会同时都使用 2 GB RAM，这种超售方案能很好工作。但是，某些主机消耗超过了资源极限，最终会产生不符合预期的性能表现。固然是需要根据容量规划来设计超售配比。\n\n## 性能\n\n​    设计任何一套云平台，性能都是核心考虑因素。随着规模和复杂度的提升，性能越显突出。单站点、私有云基本是可控的，多站点和混合部署则需要更多关注规划来减少问题，比如站点间的延迟。\n\n​    例如，你应该考虑各种方法来降低不同云平台间的工作负载耗时。这可能需要将数据搬得离应用更近些，或者将应用更靠近数据的地方以及功能化分组，最终在单套云平台内获得更低延迟的连接，甚至在多套云平台间。\n\n​    这样可能需要一套 CMP 云管平台来协助决策哪些云资源适合哪些类的工作负载。\n\n​    使用原生的 OpenStack 工具集能够帮助提升性能。比如，你可以使用遥测来衡量性能以及编排服务（心跳），以应对按需带来的变化。\n\n### 云资源部署\n\n​    云平台用户期望拥有可重叠的、可依赖的以及确定的进程来拉起和部署云资源。你应该通过基于 web 界面接口或者公共可用的 API 端点来发布这些资源。所有请求云资源的可能选项都必需通过某种用户接口、命令式接口（CLI）或者 API 端点来启用。\n\n### 消费模型\n\n​    云平台用户期望一种完全自助、按需获取的消费模型。当一个 OpenStack 云平台满足了海量可伸缩的资源诉求，能轻松应对该种消费模型。\n\n- 一切必需自动化。例如，所有的计算硬件、存储硬件、网络硬件，采用某种可支持的软件来进行安装及配置。手动操作对构建海量可伸缩的 OpenStack 设计架构是不切实际的。\n- 海量可伸缩的 OpenStack 云平台需要配齐可扩展的度量和监控功能来最大化运维效率，通过保持知悉这些基础设施的状态信息。这就包括了全部硬件和软件的状态度量。一套同类的日志和告警功能需同样配备，用于存储和开启这些有度量和监控方案提供的度量指标。云平台运维者需要知道度量和监控方案提供的数据用于规划容量和容量趋势分析。\n\n### 位置\n\n​    对于许多用户使用场景，他们的应用性能受到工作负载的直接影响，所以在设计时应该考虑到。特定的应用通过部署在多位置的云平台，有可能获取接近零延迟。这些位置可能分布在不同的数据中心、城市、国家或者地理区域，取决于用户需求及用户所在位置。\n\n### I/O 需求\n\n​    I/O 性能需求需在决定一个最终存储框架前完成调研和建模。运行基准测试来提供预期的性能水平基线。如果这些测试包含了许多细节，最终数据能更有利于建模和评估不同的工作负载。在整个架构生命周期内，运行脚本化的小基准测试能及时记录系统健康度。这些来自脚本化基准测试的数据，在未来能帮助限定和深入理解一个组织的需求。\n\n### 伸缩\n\n​    在关注存储方面，OpenStack 架构设计可伸缩存储方案是由最初的需求驱动的，包括了 IOPS，容量，带宽以及未来需求。基于项目的容量规划，需要覆盖全程的消耗，在设计时是非常重要的。该架构应该平衡成本和容量，在两者间通过新技术和方法来满足灵活性要求。\n\n## 网络\n\n​    考虑网络的功能性、安全性、可伸缩性、可用性和可测试性是非常重要的，特别是在选择一套 CMP 平台及一家云厂商的时候。\n\n- 依赖于网络框架和设计最小功能测试用例。在升级期间或之后，这能确保测试和功能的完整性。\n- 可伸缩性涵盖多云厂商可能限定的底层网络框架，尤其在选择不同云厂商时。提供网络 API 接口功能及用于验证功能完整性，特别是选择了跨多云端点，就显得尤为重要。\n- 高可用在功能实现和设计时，都需要考虑到。常见的模式主 - 热备、主备和主主。高可用的开发和测试框架，对于保证功能和条约是非常有必要的。\n- 考虑数据在客户端和端点、不同云平台间传输流量的安全性。\n\n​    例如，视频流延迟和低质量的 VoIP 通话就会较大影响用户体验，潜在可能导致产品和经济的损失。\n\n### 网络误配置\n\n​    配置了不正确的 IP 地址、VLAN 号和路由器，都有可能引起大范围的网络故障，极端情况下，影响整套基础设施。自动化的网络配置能极小化这种运维错误的几率而导致灾难性的事故。\n\n### 容量规划\n\n​    云网络需要对容量进行管理和及时的扩充。容量规划包括了网络设备购买和硬件潜在长达数月/年的中断。\n\n### 网络调优\n\n​    配置云网络需要最小化链路缺失、丢包、包风暴、广播风暴及环路。\n\n### 单点故障\n\n​    在物理和各种环境，都要考虑高可用。如果存在单故障点，比如单个上游连接、单电源供电，都会导致无法避免的故障。\n\n### 复杂度\n\n​    一份过于复杂的网络设计，会难以运维及问题定位。在设备层面配置要易于维护，能用自动化工具处理覆盖式网络，在功能和特定设备上，通过避免或者记录下非传统式的交汇点，进而规避故障。\n\n### 非标准特性\n\n​    通过配置云厂商网络来获得厂商的特定特性，这是比较冒险的。例如 MLAG 多链接聚合模式，用来在网络交换聚合器中提供冗余度。MLAG 不是一份标准，结果不同厂商都有自己的实现逻辑。MLAG 架构是不适合于跨多交换机厂商的，它会导致被厂商锁定，以及组件升级延迟甚至不可用等。\n\n### 动态资源扩张或突发\n\n​    一个应用需要额外的资源来满足多云架构。例如，零售商只是在假期需要额外的资源，但不想再添加其他的云资源来应对需求洪峰。这些用户额外带来的突增负载，在这期间，可在公共云资源上来对应。这些突增的时间，有可能长达数小时到年不等。\n\n## 规约与地理位置\n\n​    一个组织可能有明确的法律义务和正规规约来评估哪些明确的工作负载或数据不能被落地到指定的区域。\n\n​    对于多站点的云平台，规约要素是相当重要的，包括：\n\n- 联邦法律需求\n- 本地司法法律和规约需求\n- 镜像一致性和可用性\n- 存储副本和可用性（包括块存储和文件/对象存储）\n- 认证、授权和审计（AAA）\n\n​    地理因素可能同样影响数据中心构建/租赁成本，包括：\n\n- 楼宇空间\n- 楼宇承重\n- 机柜高度和类型\n- 环境因素\n- 电力使用和电力使用有效性\n- 物理安全性\n\n## 审计\n\n​    一个全方位的审计计划，对于快速排查问题是非常关键的。持续跟踪安全组的变化和租户的变化，在生产环境对于需要回滚变更是很有用的。比如，如果某个租户的所有安全组规则消失了，迅速跟踪出该问题的能力，对于运维和合理性解释是非常的重要。\n\n## 安全\n\n​    各类型组织使用云平台有着不同级别的安全需求。例如，政府和金融机构通常由非常高的安全需求。安全应当依据资产、威胁和漏洞风险等多方位来保障。\n\n## 服务承诺\n\n​    SLA 是一定涵括在商业、技术和法律里。小的、私有的云平台可能是包含一份简单 SLA，但混合或者公有云平台通常会有多份正式协议书给到用户。\n\n​    对于一个海量可伸缩的 OpenStack 公有云平台用户，对于掌控安全、性能或可用性是没有多少期望。用户只关注 API 服务运行时长 SLA、基本的服务 SLA。用户根据职责来定位这些他们关心的议题。对于公有云设施，超出预期的是非常的罕见，构建私有或政府机构的则会有明确的清单。\n\n​    搞性能系统会有 SLA 清单说明最低等级的服务质量，涵盖保证运行时长、延迟和带宽。SLA 等级更多会受网络架构和系统冗余度需求的影响。\n\n​    混合云的 SLA 一定要满足厂商的能力和权力范围的差异。\n\n## 应用就绪状态\n\n​    有些应用是能容忍对象存储同步缺失的，但其他则需要这些对象副本并在各区域可用。理解这些云资源实现逻辑如何影响新建、或存量的应用，对于风险迁移、成功上云都是很重要的。应用可能需要重写来适配无冗余的基础设施或云平台。\n\n### 应用压力\n\n​    存量应用的业务，可能会发现，相比迁移到一套云平台，集成到多套云平台会更加艰难。\n\n### 非预期使用模型\n\n​    缺失预定义使用模型，会让用户不知如何为各种应用评估需求。它可以提供应用所需的独立程度和灵活性，这些不是其他非云平台场景下能提供的。\n\n### 按需和自助式应用\n\n​    云平台提供终端用户能通过简单灵活的方式去按需获取计算、存储、网络和软件资源。用户能够扩展资源来提升服务质量，避免受到底层操作影响。使用通用型云平台架构收益之一，就是有能力从最初有限资源开始按需扩展资源应对增长诉求。\n\n## 认证\n\n​    比较推荐采用集中式认证服务，而不是每个站点都实现一套。这就要求认证机制是高可用且支持分布式的。认证服务器定位就应该提前做好设计。\n\n## 迁移，可用性，站点损失及恢复\n\n​    故障都可能会导致部分或全部站点功能不可用。提前制定策略来应对这些场景：\n\n- 部署的应用需能够持续提供服务，站点不可用一定要考虑带来的性能和应用可靠性影响。\n- 站点故障时，弄清楚各种对象和数据副本发生了什么是很重要的。如果产生了队列阻塞，需要评估这些阻塞会持续多久就会导致系统错误。\n- 故障过后，确保能找到正确的方法来应对下一次同样的出现。我们建议你从架构上恢复策略而避免各种竞态条件。\n\n### 灾难恢复与业务持续性\n\n​    更加偏移的存储策略能让公有云找到合适的备份策略。\n\n### 迁移场景\n\n​    混合云架构能让应用在不同云平台间迁移。\n\n### 厂商可用性或实现细节\n\n​    业务变更能影响厂商的可用性。比如，服务变更就可能中断一个混合云的环境或者增加成本。\n\n### 厂商 API 变更\n\n​    依赖外部云厂商服务，难以控制厂商不去变更 API，变更可能会破坏兼容性。尽量使用通用的 API 来尽可能减少潜在的冲突。\n\n### 镜像插拔\n\n​    就像 Kilo 版本发布一样，没有一个通用镜像格式适用于所有的云平台。在不同云平台间迁移，需要提前协商好镜像格式。为了简化部署，使用最小化和最简单的镜像，只安装那些必需的组件，使用部署管理器（如 Chef、Puppet）。别为了加速处理而使用笨重的镜像，除非你是在同一云平台上部署这些镜像。\n\n### API 差异\n\n​    避免使用不仅仅只是 OpenStack 或者带有不同版本 OpenStack 的混合云平台，就像 API 变更一样会带来兼容性问题。\n\n### 业务或技术多样性\n\n​    许多组织根据业务多样性，使用多厂商的混合云平台方案来分摊这些工作负载。这能保证应用的主机资源不被厂商锁定。\n\n[^1]:https://docs.openstack.org/arch-design/arch-requirements/arch-requirements-enterprise.html\n","slug":"openstack-arch-enterprise-requirements","published":1,"updated":"2022-04-17T11:46:39.916Z","_id":"cl236bssl0000tcvh5px1ehgu","comments":1,"layout":"post","photos":[],"link":"","content":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<blockquote>\n<p>前言：个人看法，学习一门技术，先从整体架构视角去了解，让自己有个总体概念。带着问题去查阅官方文档，技术路线会更加清晰，比如它为什么会出现（背景）、帮助谁解决什么样的问题（场景）、如何解决的（方式）、设计思路是什么（架构）。</p>\n<p>本篇文章内容翻译自 OpenStack 官网 <a href=\"https://docs.openstack.org/arch-design/arch-requirements/arch-requirements-enterprise.html\">^1</a>。</p>\n</blockquote>\n<p>总的看，从 13 个方面来考虑影响基于 OpenStack 构建的云设施。分别是：</p>\n<span id=\"more\"></span>\n\n<ol>\n<li>成本</li>\n<li>上市耗时</li>\n<li>机遇收益</li>\n<li>容量规划与扩展</li>\n<li>性能</li>\n<li>网络</li>\n<li>规约与地理位置</li>\n<li>审计</li>\n<li>安全</li>\n<li>服务承诺</li>\n<li>应用就绪状态</li>\n<li>认证</li>\n<li>迁移，可用性，站点损失及恢复</li>\n</ol>\n<!--more-->\n\n<p>​    对于任何一个组织，财务都是主要考虑的因素。成本的考虑会很大程度上影响你所能构建成什么类型的云平台。在选择或者设计云平台时，成本不应该成为制约因素。</p>\n<p>​    作为一份通用指引，云平台架构复杂性的增加，构建和维护的成本也会同步增加。比如，一朵混合或多站点部署的云架构，涵盖了多供应商和多种技术架构，就可能需要投入更高的安装和运维成本；因为相比其他架构，它需要更先进的编排系统和易用的工具集。</p>\n<p>​    设计一套云平台，通常会考虑以下成本目录：</p>\n<ul>\n<li>计算资源</li>\n<li>网络资源</li>\n<li>平台副本</li>\n<li>存储资源</li>\n<li>平台管理</li>\n<li>运维成本</li>\n</ul>\n<p>​    云平台扩展时所需的成本，需要重点考虑。同时，整体建设成本最小化也是比较重要的。运维海量可扩展的 OpenStack 云平台时，使用商业硬件和自由可用的开源软件组件，有助于降低部署成本和运维投入，可参考 <a href=\"http://www.opencompute.org/\">Open Compute</a> 提供的额外信息。</p>\n<h2 id=\"上市耗时\"><a href=\"#上市耗时\" class=\"headerlink\" title=\"上市耗时\"></a>上市耗时</h2><p>​    构建云平台时，是否具备相对稳定的服务或产品发布耗时能力，是常见的商业因素。让用户自助按需获得计算、网络、存储资源，可能帮助到他们的产品或者应用减少投产上市的时间。</p>\n<p>​    你需要权衡构建云平台和迁移用户上云的耗时。在某些场景下，现有的基础设施会影响他们的架构选型。比如，对于一个已有的投资系统（内含多个应用），使用多云平台可能会是一个更优选项，毕竟它能快速地将各组件串联在一起而不是全部重构上到一套云平台。</p>\n<h2 id=\"机遇收益\"><a href=\"#机遇收益\" class=\"headerlink\" title=\"机遇收益\"></a>机遇收益</h2><p>​    机遇收益很大程度上受制于云平台的意图和用户案例。商业需求、客户面临的产品都会不同程度上影响到一套内部的、私有的云平台。你一定要考虑云平台具备哪些功能特性，来吸引你的用户。</p>\n<h2 id=\"容量规划与扩展\"><a href=\"#容量规划与扩展\" class=\"headerlink\" title=\"容量规划与扩展\"></a>容量规划与扩展</h2><p>​    容量和工作负载的布置是云平台的关键设计因素。长期的容量规划必定满足随时间推移的增长需求，避免资源耗尽的情况。</p>\n<p>​    预测特定应用工作负载是比较困难的，因为它受用户量、应用成熟度等因素影响。定义出应用需求还是很有可能的，比如 vCPU，RAM，bandwidth，及其他资源。不同云平台可能使用不同的度量维度，甚至会有不同的超售配额。</p>\n<p>​    超售配额是一种虚拟化出比物理资源更多大容量的方式。例如，一台 32 GB RAM 物理节点可能承载着 24 个 2 GB RAM 主机实例。这 24 个实例并不会同时都使用 2 GB RAM，这种超售方案能很好工作。但是，某些主机消耗超过了资源极限，最终会产生不符合预期的性能表现。固然是需要根据容量规划来设计超售配比。</p>\n<h2 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h2><p>​    设计任何一套云平台，性能都是核心考虑因素。随着规模和复杂度的提升，性能越显突出。单站点、私有云基本是可控的，多站点和混合部署则需要更多关注规划来减少问题，比如站点间的延迟。</p>\n<p>​    例如，你应该考虑各种方法来降低不同云平台间的工作负载耗时。这可能需要将数据搬得离应用更近些，或者将应用更靠近数据的地方以及功能化分组，最终在单套云平台内获得更低延迟的连接，甚至在多套云平台间。</p>\n<p>​    这样可能需要一套 CMP 云管平台来协助决策哪些云资源适合哪些类的工作负载。</p>\n<p>​    使用原生的 OpenStack 工具集能够帮助提升性能。比如，你可以使用遥测来衡量性能以及编排服务（心跳），以应对按需带来的变化。</p>\n<h3 id=\"云资源部署\"><a href=\"#云资源部署\" class=\"headerlink\" title=\"云资源部署\"></a>云资源部署</h3><p>​    云平台用户期望拥有可重叠的、可依赖的以及确定的进程来拉起和部署云资源。你应该通过基于 web 界面接口或者公共可用的 API 端点来发布这些资源。所有请求云资源的可能选项都必需通过某种用户接口、命令式接口（CLI）或者 API 端点来启用。</p>\n<h3 id=\"消费模型\"><a href=\"#消费模型\" class=\"headerlink\" title=\"消费模型\"></a>消费模型</h3><p>​    云平台用户期望一种完全自助、按需获取的消费模型。当一个 OpenStack 云平台满足了海量可伸缩的资源诉求，能轻松应对该种消费模型。</p>\n<ul>\n<li>一切必需自动化。例如，所有的计算硬件、存储硬件、网络硬件，采用某种可支持的软件来进行安装及配置。手动操作对构建海量可伸缩的 OpenStack 设计架构是不切实际的。</li>\n<li>海量可伸缩的 OpenStack 云平台需要配齐可扩展的度量和监控功能来最大化运维效率，通过保持知悉这些基础设施的状态信息。这就包括了全部硬件和软件的状态度量。一套同类的日志和告警功能需同样配备，用于存储和开启这些有度量和监控方案提供的度量指标。云平台运维者需要知道度量和监控方案提供的数据用于规划容量和容量趋势分析。</li>\n</ul>\n<h3 id=\"位置\"><a href=\"#位置\" class=\"headerlink\" title=\"位置\"></a>位置</h3><p>​    对于许多用户使用场景，他们的应用性能受到工作负载的直接影响，所以在设计时应该考虑到。特定的应用通过部署在多位置的云平台，有可能获取接近零延迟。这些位置可能分布在不同的数据中心、城市、国家或者地理区域，取决于用户需求及用户所在位置。</p>\n<h3 id=\"I-x2F-O-需求\"><a href=\"#I-x2F-O-需求\" class=\"headerlink\" title=\"I&#x2F;O 需求\"></a>I&#x2F;O 需求</h3><p>​    I&#x2F;O 性能需求需在决定一个最终存储框架前完成调研和建模。运行基准测试来提供预期的性能水平基线。如果这些测试包含了许多细节，最终数据能更有利于建模和评估不同的工作负载。在整个架构生命周期内，运行脚本化的小基准测试能及时记录系统健康度。这些来自脚本化基准测试的数据，在未来能帮助限定和深入理解一个组织的需求。</p>\n<h3 id=\"伸缩\"><a href=\"#伸缩\" class=\"headerlink\" title=\"伸缩\"></a>伸缩</h3><p>​    在关注存储方面，OpenStack 架构设计可伸缩存储方案是由最初的需求驱动的，包括了 IOPS，容量，带宽以及未来需求。基于项目的容量规划，需要覆盖全程的消耗，在设计时是非常重要的。该架构应该平衡成本和容量，在两者间通过新技术和方法来满足灵活性要求。</p>\n<h2 id=\"网络\"><a href=\"#网络\" class=\"headerlink\" title=\"网络\"></a>网络</h2><p>​    考虑网络的功能性、安全性、可伸缩性、可用性和可测试性是非常重要的，特别是在选择一套 CMP 平台及一家云厂商的时候。</p>\n<ul>\n<li>依赖于网络框架和设计最小功能测试用例。在升级期间或之后，这能确保测试和功能的完整性。</li>\n<li>可伸缩性涵盖多云厂商可能限定的底层网络框架，尤其在选择不同云厂商时。提供网络 API 接口功能及用于验证功能完整性，特别是选择了跨多云端点，就显得尤为重要。</li>\n<li>高可用在功能实现和设计时，都需要考虑到。常见的模式主 - 热备、主备和主主。高可用的开发和测试框架，对于保证功能和条约是非常有必要的。</li>\n<li>考虑数据在客户端和端点、不同云平台间传输流量的安全性。</li>\n</ul>\n<p>​    例如，视频流延迟和低质量的 VoIP 通话就会较大影响用户体验，潜在可能导致产品和经济的损失。</p>\n<h3 id=\"网络误配置\"><a href=\"#网络误配置\" class=\"headerlink\" title=\"网络误配置\"></a>网络误配置</h3><p>​    配置了不正确的 IP 地址、VLAN 号和路由器，都有可能引起大范围的网络故障，极端情况下，影响整套基础设施。自动化的网络配置能极小化这种运维错误的几率而导致灾难性的事故。</p>\n<h3 id=\"容量规划\"><a href=\"#容量规划\" class=\"headerlink\" title=\"容量规划\"></a>容量规划</h3><p>​    云网络需要对容量进行管理和及时的扩充。容量规划包括了网络设备购买和硬件潜在长达数月&#x2F;年的中断。</p>\n<h3 id=\"网络调优\"><a href=\"#网络调优\" class=\"headerlink\" title=\"网络调优\"></a>网络调优</h3><p>​    配置云网络需要最小化链路缺失、丢包、包风暴、广播风暴及环路。</p>\n<h3 id=\"单点故障\"><a href=\"#单点故障\" class=\"headerlink\" title=\"单点故障\"></a>单点故障</h3><p>​    在物理和各种环境，都要考虑高可用。如果存在单故障点，比如单个上游连接、单电源供电，都会导致无法避免的故障。</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>​    一份过于复杂的网络设计，会难以运维及问题定位。在设备层面配置要易于维护，能用自动化工具处理覆盖式网络，在功能和特定设备上，通过避免或者记录下非传统式的交汇点，进而规避故障。</p>\n<h3 id=\"非标准特性\"><a href=\"#非标准特性\" class=\"headerlink\" title=\"非标准特性\"></a>非标准特性</h3><p>​    通过配置云厂商网络来获得厂商的特定特性，这是比较冒险的。例如 MLAG 多链接聚合模式，用来在网络交换聚合器中提供冗余度。MLAG 不是一份标准，结果不同厂商都有自己的实现逻辑。MLAG 架构是不适合于跨多交换机厂商的，它会导致被厂商锁定，以及组件升级延迟甚至不可用等。</p>\n<h3 id=\"动态资源扩张或突发\"><a href=\"#动态资源扩张或突发\" class=\"headerlink\" title=\"动态资源扩张或突发\"></a>动态资源扩张或突发</h3><p>​    一个应用需要额外的资源来满足多云架构。例如，零售商只是在假期需要额外的资源，但不想再添加其他的云资源来应对需求洪峰。这些用户额外带来的突增负载，在这期间，可在公共云资源上来对应。这些突增的时间，有可能长达数小时到年不等。</p>\n<h2 id=\"规约与地理位置\"><a href=\"#规约与地理位置\" class=\"headerlink\" title=\"规约与地理位置\"></a>规约与地理位置</h2><p>​    一个组织可能有明确的法律义务和正规规约来评估哪些明确的工作负载或数据不能被落地到指定的区域。</p>\n<p>​    对于多站点的云平台，规约要素是相当重要的，包括：</p>\n<ul>\n<li>联邦法律需求</li>\n<li>本地司法法律和规约需求</li>\n<li>镜像一致性和可用性</li>\n<li>存储副本和可用性（包括块存储和文件&#x2F;对象存储）</li>\n<li>认证、授权和审计（AAA）</li>\n</ul>\n<p>​    地理因素可能同样影响数据中心构建&#x2F;租赁成本，包括：</p>\n<ul>\n<li>楼宇空间</li>\n<li>楼宇承重</li>\n<li>机柜高度和类型</li>\n<li>环境因素</li>\n<li>电力使用和电力使用有效性</li>\n<li>物理安全性</li>\n</ul>\n<h2 id=\"审计\"><a href=\"#审计\" class=\"headerlink\" title=\"审计\"></a>审计</h2><p>​    一个全方位的审计计划，对于快速排查问题是非常关键的。持续跟踪安全组的变化和租户的变化，在生产环境对于需要回滚变更是很有用的。比如，如果某个租户的所有安全组规则消失了，迅速跟踪出该问题的能力，对于运维和合理性解释是非常的重要。</p>\n<h2 id=\"安全\"><a href=\"#安全\" class=\"headerlink\" title=\"安全\"></a>安全</h2><p>​    各类型组织使用云平台有着不同级别的安全需求。例如，政府和金融机构通常由非常高的安全需求。安全应当依据资产、威胁和漏洞风险等多方位来保障。</p>\n<h2 id=\"服务承诺\"><a href=\"#服务承诺\" class=\"headerlink\" title=\"服务承诺\"></a>服务承诺</h2><p>​    SLA 是一定涵括在商业、技术和法律里。小的、私有的云平台可能是包含一份简单 SLA，但混合或者公有云平台通常会有多份正式协议书给到用户。</p>\n<p>​    对于一个海量可伸缩的 OpenStack 公有云平台用户，对于掌控安全、性能或可用性是没有多少期望。用户只关注 API 服务运行时长 SLA、基本的服务 SLA。用户根据职责来定位这些他们关心的议题。对于公有云设施，超出预期的是非常的罕见，构建私有或政府机构的则会有明确的清单。</p>\n<p>​    搞性能系统会有 SLA 清单说明最低等级的服务质量，涵盖保证运行时长、延迟和带宽。SLA 等级更多会受网络架构和系统冗余度需求的影响。</p>\n<p>​    混合云的 SLA 一定要满足厂商的能力和权力范围的差异。</p>\n<h2 id=\"应用就绪状态\"><a href=\"#应用就绪状态\" class=\"headerlink\" title=\"应用就绪状态\"></a>应用就绪状态</h2><p>​    有些应用是能容忍对象存储同步缺失的，但其他则需要这些对象副本并在各区域可用。理解这些云资源实现逻辑如何影响新建、或存量的应用，对于风险迁移、成功上云都是很重要的。应用可能需要重写来适配无冗余的基础设施或云平台。</p>\n<h3 id=\"应用压力\"><a href=\"#应用压力\" class=\"headerlink\" title=\"应用压力\"></a>应用压力</h3><p>​    存量应用的业务，可能会发现，相比迁移到一套云平台，集成到多套云平台会更加艰难。</p>\n<h3 id=\"非预期使用模型\"><a href=\"#非预期使用模型\" class=\"headerlink\" title=\"非预期使用模型\"></a>非预期使用模型</h3><p>​    缺失预定义使用模型，会让用户不知如何为各种应用评估需求。它可以提供应用所需的独立程度和灵活性，这些不是其他非云平台场景下能提供的。</p>\n<h3 id=\"按需和自助式应用\"><a href=\"#按需和自助式应用\" class=\"headerlink\" title=\"按需和自助式应用\"></a>按需和自助式应用</h3><p>​    云平台提供终端用户能通过简单灵活的方式去按需获取计算、存储、网络和软件资源。用户能够扩展资源来提升服务质量，避免受到底层操作影响。使用通用型云平台架构收益之一，就是有能力从最初有限资源开始按需扩展资源应对增长诉求。</p>\n<h2 id=\"认证\"><a href=\"#认证\" class=\"headerlink\" title=\"认证\"></a>认证</h2><p>​    比较推荐采用集中式认证服务，而不是每个站点都实现一套。这就要求认证机制是高可用且支持分布式的。认证服务器定位就应该提前做好设计。</p>\n<h2 id=\"迁移，可用性，站点损失及恢复\"><a href=\"#迁移，可用性，站点损失及恢复\" class=\"headerlink\" title=\"迁移，可用性，站点损失及恢复\"></a>迁移，可用性，站点损失及恢复</h2><p>​    故障都可能会导致部分或全部站点功能不可用。提前制定策略来应对这些场景：</p>\n<ul>\n<li>部署的应用需能够持续提供服务，站点不可用一定要考虑带来的性能和应用可靠性影响。</li>\n<li>站点故障时，弄清楚各种对象和数据副本发生了什么是很重要的。如果产生了队列阻塞，需要评估这些阻塞会持续多久就会导致系统错误。</li>\n<li>故障过后，确保能找到正确的方法来应对下一次同样的出现。我们建议你从架构上恢复策略而避免各种竞态条件。</li>\n</ul>\n<h3 id=\"灾难恢复与业务持续性\"><a href=\"#灾难恢复与业务持续性\" class=\"headerlink\" title=\"灾难恢复与业务持续性\"></a>灾难恢复与业务持续性</h3><p>​    更加偏移的存储策略能让公有云找到合适的备份策略。</p>\n<h3 id=\"迁移场景\"><a href=\"#迁移场景\" class=\"headerlink\" title=\"迁移场景\"></a>迁移场景</h3><p>​    混合云架构能让应用在不同云平台间迁移。</p>\n<h3 id=\"厂商可用性或实现细节\"><a href=\"#厂商可用性或实现细节\" class=\"headerlink\" title=\"厂商可用性或实现细节\"></a>厂商可用性或实现细节</h3><p>​    业务变更能影响厂商的可用性。比如，服务变更就可能中断一个混合云的环境或者增加成本。</p>\n<h3 id=\"厂商-API-变更\"><a href=\"#厂商-API-变更\" class=\"headerlink\" title=\"厂商 API 变更\"></a>厂商 API 变更</h3><p>​    依赖外部云厂商服务，难以控制厂商不去变更 API，变更可能会破坏兼容性。尽量使用通用的 API 来尽可能减少潜在的冲突。</p>\n<h3 id=\"镜像插拔\"><a href=\"#镜像插拔\" class=\"headerlink\" title=\"镜像插拔\"></a>镜像插拔</h3><p>​    就像 Kilo 版本发布一样，没有一个通用镜像格式适用于所有的云平台。在不同云平台间迁移，需要提前协商好镜像格式。为了简化部署，使用最小化和最简单的镜像，只安装那些必需的组件，使用部署管理器（如 Chef、Puppet）。别为了加速处理而使用笨重的镜像，除非你是在同一云平台上部署这些镜像。</p>\n<h3 id=\"API-差异\"><a href=\"#API-差异\" class=\"headerlink\" title=\"API 差异\"></a>API 差异</h3><p>​    避免使用不仅仅只是 OpenStack 或者带有不同版本 OpenStack 的混合云平台，就像 API 变更一样会带来兼容性问题。</p>\n<h3 id=\"业务或技术多样性\"><a href=\"#业务或技术多样性\" class=\"headerlink\" title=\"业务或技术多样性\"></a>业务或技术多样性</h3><p>​    许多组织根据业务多样性，使用多厂商的混合云平台方案来分摊这些工作负载。这能保证应用的主机资源不被厂商锁定。</p>\n","site":{"data":{}},"excerpt":"<!--\n  ~ Copyright 2022 kwanhur\n  ~\n  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n  ~ you may not use this file except in compliance with the License.\n  ~ You may obtain a copy of the License at\n  ~\n  ~ http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing, software\n  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  ~ See the License for the specific language governing permissions and\n  ~ limitations under the License.\n  ~\n-->\n\n<blockquote>\n<p>前言：个人看法，学习一门技术，先从整体架构视角去了解，让自己有个总体概念。带着问题去查阅官方文档，技术路线会更加清晰，比如它为什么会出现（背景）、帮助谁解决什么样的问题（场景）、如何解决的（方式）、设计思路是什么（架构）。</p>\n<p>本篇文章内容翻译自 OpenStack 官网 <a href=\"https://docs.openstack.org/arch-design/arch-requirements/arch-requirements-enterprise.html\">^1</a>。</p>\n</blockquote>\n<p>总的看，从 13 个方面来考虑影响基于 OpenStack 构建的云设施。分别是：</p>","more":"<ol>\n<li>成本</li>\n<li>上市耗时</li>\n<li>机遇收益</li>\n<li>容量规划与扩展</li>\n<li>性能</li>\n<li>网络</li>\n<li>规约与地理位置</li>\n<li>审计</li>\n<li>安全</li>\n<li>服务承诺</li>\n<li>应用就绪状态</li>\n<li>认证</li>\n<li>迁移，可用性，站点损失及恢复</li>\n</ol>\n<!--more-->\n\n<p>​    对于任何一个组织，财务都是主要考虑的因素。成本的考虑会很大程度上影响你所能构建成什么类型的云平台。在选择或者设计云平台时，成本不应该成为制约因素。</p>\n<p>​    作为一份通用指引，云平台架构复杂性的增加，构建和维护的成本也会同步增加。比如，一朵混合或多站点部署的云架构，涵盖了多供应商和多种技术架构，就可能需要投入更高的安装和运维成本；因为相比其他架构，它需要更先进的编排系统和易用的工具集。</p>\n<p>​    设计一套云平台，通常会考虑以下成本目录：</p>\n<ul>\n<li>计算资源</li>\n<li>网络资源</li>\n<li>平台副本</li>\n<li>存储资源</li>\n<li>平台管理</li>\n<li>运维成本</li>\n</ul>\n<p>​    云平台扩展时所需的成本，需要重点考虑。同时，整体建设成本最小化也是比较重要的。运维海量可扩展的 OpenStack 云平台时，使用商业硬件和自由可用的开源软件组件，有助于降低部署成本和运维投入，可参考 <a href=\"http://www.opencompute.org/\">Open Compute</a> 提供的额外信息。</p>\n<h2 id=\"上市耗时\"><a href=\"#上市耗时\" class=\"headerlink\" title=\"上市耗时\"></a>上市耗时</h2><p>​    构建云平台时，是否具备相对稳定的服务或产品发布耗时能力，是常见的商业因素。让用户自助按需获得计算、网络、存储资源，可能帮助到他们的产品或者应用减少投产上市的时间。</p>\n<p>​    你需要权衡构建云平台和迁移用户上云的耗时。在某些场景下，现有的基础设施会影响他们的架构选型。比如，对于一个已有的投资系统（内含多个应用），使用多云平台可能会是一个更优选项，毕竟它能快速地将各组件串联在一起而不是全部重构上到一套云平台。</p>\n<h2 id=\"机遇收益\"><a href=\"#机遇收益\" class=\"headerlink\" title=\"机遇收益\"></a>机遇收益</h2><p>​    机遇收益很大程度上受制于云平台的意图和用户案例。商业需求、客户面临的产品都会不同程度上影响到一套内部的、私有的云平台。你一定要考虑云平台具备哪些功能特性，来吸引你的用户。</p>\n<h2 id=\"容量规划与扩展\"><a href=\"#容量规划与扩展\" class=\"headerlink\" title=\"容量规划与扩展\"></a>容量规划与扩展</h2><p>​    容量和工作负载的布置是云平台的关键设计因素。长期的容量规划必定满足随时间推移的增长需求，避免资源耗尽的情况。</p>\n<p>​    预测特定应用工作负载是比较困难的，因为它受用户量、应用成熟度等因素影响。定义出应用需求还是很有可能的，比如 vCPU，RAM，bandwidth，及其他资源。不同云平台可能使用不同的度量维度，甚至会有不同的超售配额。</p>\n<p>​    超售配额是一种虚拟化出比物理资源更多大容量的方式。例如，一台 32 GB RAM 物理节点可能承载着 24 个 2 GB RAM 主机实例。这 24 个实例并不会同时都使用 2 GB RAM，这种超售方案能很好工作。但是，某些主机消耗超过了资源极限，最终会产生不符合预期的性能表现。固然是需要根据容量规划来设计超售配比。</p>\n<h2 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h2><p>​    设计任何一套云平台，性能都是核心考虑因素。随着规模和复杂度的提升，性能越显突出。单站点、私有云基本是可控的，多站点和混合部署则需要更多关注规划来减少问题，比如站点间的延迟。</p>\n<p>​    例如，你应该考虑各种方法来降低不同云平台间的工作负载耗时。这可能需要将数据搬得离应用更近些，或者将应用更靠近数据的地方以及功能化分组，最终在单套云平台内获得更低延迟的连接，甚至在多套云平台间。</p>\n<p>​    这样可能需要一套 CMP 云管平台来协助决策哪些云资源适合哪些类的工作负载。</p>\n<p>​    使用原生的 OpenStack 工具集能够帮助提升性能。比如，你可以使用遥测来衡量性能以及编排服务（心跳），以应对按需带来的变化。</p>\n<h3 id=\"云资源部署\"><a href=\"#云资源部署\" class=\"headerlink\" title=\"云资源部署\"></a>云资源部署</h3><p>​    云平台用户期望拥有可重叠的、可依赖的以及确定的进程来拉起和部署云资源。你应该通过基于 web 界面接口或者公共可用的 API 端点来发布这些资源。所有请求云资源的可能选项都必需通过某种用户接口、命令式接口（CLI）或者 API 端点来启用。</p>\n<h3 id=\"消费模型\"><a href=\"#消费模型\" class=\"headerlink\" title=\"消费模型\"></a>消费模型</h3><p>​    云平台用户期望一种完全自助、按需获取的消费模型。当一个 OpenStack 云平台满足了海量可伸缩的资源诉求，能轻松应对该种消费模型。</p>\n<ul>\n<li>一切必需自动化。例如，所有的计算硬件、存储硬件、网络硬件，采用某种可支持的软件来进行安装及配置。手动操作对构建海量可伸缩的 OpenStack 设计架构是不切实际的。</li>\n<li>海量可伸缩的 OpenStack 云平台需要配齐可扩展的度量和监控功能来最大化运维效率，通过保持知悉这些基础设施的状态信息。这就包括了全部硬件和软件的状态度量。一套同类的日志和告警功能需同样配备，用于存储和开启这些有度量和监控方案提供的度量指标。云平台运维者需要知道度量和监控方案提供的数据用于规划容量和容量趋势分析。</li>\n</ul>\n<h3 id=\"位置\"><a href=\"#位置\" class=\"headerlink\" title=\"位置\"></a>位置</h3><p>​    对于许多用户使用场景，他们的应用性能受到工作负载的直接影响，所以在设计时应该考虑到。特定的应用通过部署在多位置的云平台，有可能获取接近零延迟。这些位置可能分布在不同的数据中心、城市、国家或者地理区域，取决于用户需求及用户所在位置。</p>\n<h3 id=\"I-x2F-O-需求\"><a href=\"#I-x2F-O-需求\" class=\"headerlink\" title=\"I&#x2F;O 需求\"></a>I&#x2F;O 需求</h3><p>​    I&#x2F;O 性能需求需在决定一个最终存储框架前完成调研和建模。运行基准测试来提供预期的性能水平基线。如果这些测试包含了许多细节，最终数据能更有利于建模和评估不同的工作负载。在整个架构生命周期内，运行脚本化的小基准测试能及时记录系统健康度。这些来自脚本化基准测试的数据，在未来能帮助限定和深入理解一个组织的需求。</p>\n<h3 id=\"伸缩\"><a href=\"#伸缩\" class=\"headerlink\" title=\"伸缩\"></a>伸缩</h3><p>​    在关注存储方面，OpenStack 架构设计可伸缩存储方案是由最初的需求驱动的，包括了 IOPS，容量，带宽以及未来需求。基于项目的容量规划，需要覆盖全程的消耗，在设计时是非常重要的。该架构应该平衡成本和容量，在两者间通过新技术和方法来满足灵活性要求。</p>\n<h2 id=\"网络\"><a href=\"#网络\" class=\"headerlink\" title=\"网络\"></a>网络</h2><p>​    考虑网络的功能性、安全性、可伸缩性、可用性和可测试性是非常重要的，特别是在选择一套 CMP 平台及一家云厂商的时候。</p>\n<ul>\n<li>依赖于网络框架和设计最小功能测试用例。在升级期间或之后，这能确保测试和功能的完整性。</li>\n<li>可伸缩性涵盖多云厂商可能限定的底层网络框架，尤其在选择不同云厂商时。提供网络 API 接口功能及用于验证功能完整性，特别是选择了跨多云端点，就显得尤为重要。</li>\n<li>高可用在功能实现和设计时，都需要考虑到。常见的模式主 - 热备、主备和主主。高可用的开发和测试框架，对于保证功能和条约是非常有必要的。</li>\n<li>考虑数据在客户端和端点、不同云平台间传输流量的安全性。</li>\n</ul>\n<p>​    例如，视频流延迟和低质量的 VoIP 通话就会较大影响用户体验，潜在可能导致产品和经济的损失。</p>\n<h3 id=\"网络误配置\"><a href=\"#网络误配置\" class=\"headerlink\" title=\"网络误配置\"></a>网络误配置</h3><p>​    配置了不正确的 IP 地址、VLAN 号和路由器，都有可能引起大范围的网络故障，极端情况下，影响整套基础设施。自动化的网络配置能极小化这种运维错误的几率而导致灾难性的事故。</p>\n<h3 id=\"容量规划\"><a href=\"#容量规划\" class=\"headerlink\" title=\"容量规划\"></a>容量规划</h3><p>​    云网络需要对容量进行管理和及时的扩充。容量规划包括了网络设备购买和硬件潜在长达数月&#x2F;年的中断。</p>\n<h3 id=\"网络调优\"><a href=\"#网络调优\" class=\"headerlink\" title=\"网络调优\"></a>网络调优</h3><p>​    配置云网络需要最小化链路缺失、丢包、包风暴、广播风暴及环路。</p>\n<h3 id=\"单点故障\"><a href=\"#单点故障\" class=\"headerlink\" title=\"单点故障\"></a>单点故障</h3><p>​    在物理和各种环境，都要考虑高可用。如果存在单故障点，比如单个上游连接、单电源供电，都会导致无法避免的故障。</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>​    一份过于复杂的网络设计，会难以运维及问题定位。在设备层面配置要易于维护，能用自动化工具处理覆盖式网络，在功能和特定设备上，通过避免或者记录下非传统式的交汇点，进而规避故障。</p>\n<h3 id=\"非标准特性\"><a href=\"#非标准特性\" class=\"headerlink\" title=\"非标准特性\"></a>非标准特性</h3><p>​    通过配置云厂商网络来获得厂商的特定特性，这是比较冒险的。例如 MLAG 多链接聚合模式，用来在网络交换聚合器中提供冗余度。MLAG 不是一份标准，结果不同厂商都有自己的实现逻辑。MLAG 架构是不适合于跨多交换机厂商的，它会导致被厂商锁定，以及组件升级延迟甚至不可用等。</p>\n<h3 id=\"动态资源扩张或突发\"><a href=\"#动态资源扩张或突发\" class=\"headerlink\" title=\"动态资源扩张或突发\"></a>动态资源扩张或突发</h3><p>​    一个应用需要额外的资源来满足多云架构。例如，零售商只是在假期需要额外的资源，但不想再添加其他的云资源来应对需求洪峰。这些用户额外带来的突增负载，在这期间，可在公共云资源上来对应。这些突增的时间，有可能长达数小时到年不等。</p>\n<h2 id=\"规约与地理位置\"><a href=\"#规约与地理位置\" class=\"headerlink\" title=\"规约与地理位置\"></a>规约与地理位置</h2><p>​    一个组织可能有明确的法律义务和正规规约来评估哪些明确的工作负载或数据不能被落地到指定的区域。</p>\n<p>​    对于多站点的云平台，规约要素是相当重要的，包括：</p>\n<ul>\n<li>联邦法律需求</li>\n<li>本地司法法律和规约需求</li>\n<li>镜像一致性和可用性</li>\n<li>存储副本和可用性（包括块存储和文件&#x2F;对象存储）</li>\n<li>认证、授权和审计（AAA）</li>\n</ul>\n<p>​    地理因素可能同样影响数据中心构建&#x2F;租赁成本，包括：</p>\n<ul>\n<li>楼宇空间</li>\n<li>楼宇承重</li>\n<li>机柜高度和类型</li>\n<li>环境因素</li>\n<li>电力使用和电力使用有效性</li>\n<li>物理安全性</li>\n</ul>\n<h2 id=\"审计\"><a href=\"#审计\" class=\"headerlink\" title=\"审计\"></a>审计</h2><p>​    一个全方位的审计计划，对于快速排查问题是非常关键的。持续跟踪安全组的变化和租户的变化，在生产环境对于需要回滚变更是很有用的。比如，如果某个租户的所有安全组规则消失了，迅速跟踪出该问题的能力，对于运维和合理性解释是非常的重要。</p>\n<h2 id=\"安全\"><a href=\"#安全\" class=\"headerlink\" title=\"安全\"></a>安全</h2><p>​    各类型组织使用云平台有着不同级别的安全需求。例如，政府和金融机构通常由非常高的安全需求。安全应当依据资产、威胁和漏洞风险等多方位来保障。</p>\n<h2 id=\"服务承诺\"><a href=\"#服务承诺\" class=\"headerlink\" title=\"服务承诺\"></a>服务承诺</h2><p>​    SLA 是一定涵括在商业、技术和法律里。小的、私有的云平台可能是包含一份简单 SLA，但混合或者公有云平台通常会有多份正式协议书给到用户。</p>\n<p>​    对于一个海量可伸缩的 OpenStack 公有云平台用户，对于掌控安全、性能或可用性是没有多少期望。用户只关注 API 服务运行时长 SLA、基本的服务 SLA。用户根据职责来定位这些他们关心的议题。对于公有云设施，超出预期的是非常的罕见，构建私有或政府机构的则会有明确的清单。</p>\n<p>​    搞性能系统会有 SLA 清单说明最低等级的服务质量，涵盖保证运行时长、延迟和带宽。SLA 等级更多会受网络架构和系统冗余度需求的影响。</p>\n<p>​    混合云的 SLA 一定要满足厂商的能力和权力范围的差异。</p>\n<h2 id=\"应用就绪状态\"><a href=\"#应用就绪状态\" class=\"headerlink\" title=\"应用就绪状态\"></a>应用就绪状态</h2><p>​    有些应用是能容忍对象存储同步缺失的，但其他则需要这些对象副本并在各区域可用。理解这些云资源实现逻辑如何影响新建、或存量的应用，对于风险迁移、成功上云都是很重要的。应用可能需要重写来适配无冗余的基础设施或云平台。</p>\n<h3 id=\"应用压力\"><a href=\"#应用压力\" class=\"headerlink\" title=\"应用压力\"></a>应用压力</h3><p>​    存量应用的业务，可能会发现，相比迁移到一套云平台，集成到多套云平台会更加艰难。</p>\n<h3 id=\"非预期使用模型\"><a href=\"#非预期使用模型\" class=\"headerlink\" title=\"非预期使用模型\"></a>非预期使用模型</h3><p>​    缺失预定义使用模型，会让用户不知如何为各种应用评估需求。它可以提供应用所需的独立程度和灵活性，这些不是其他非云平台场景下能提供的。</p>\n<h3 id=\"按需和自助式应用\"><a href=\"#按需和自助式应用\" class=\"headerlink\" title=\"按需和自助式应用\"></a>按需和自助式应用</h3><p>​    云平台提供终端用户能通过简单灵活的方式去按需获取计算、存储、网络和软件资源。用户能够扩展资源来提升服务质量，避免受到底层操作影响。使用通用型云平台架构收益之一，就是有能力从最初有限资源开始按需扩展资源应对增长诉求。</p>\n<h2 id=\"认证\"><a href=\"#认证\" class=\"headerlink\" title=\"认证\"></a>认证</h2><p>​    比较推荐采用集中式认证服务，而不是每个站点都实现一套。这就要求认证机制是高可用且支持分布式的。认证服务器定位就应该提前做好设计。</p>\n<h2 id=\"迁移，可用性，站点损失及恢复\"><a href=\"#迁移，可用性，站点损失及恢复\" class=\"headerlink\" title=\"迁移，可用性，站点损失及恢复\"></a>迁移，可用性，站点损失及恢复</h2><p>​    故障都可能会导致部分或全部站点功能不可用。提前制定策略来应对这些场景：</p>\n<ul>\n<li>部署的应用需能够持续提供服务，站点不可用一定要考虑带来的性能和应用可靠性影响。</li>\n<li>站点故障时，弄清楚各种对象和数据副本发生了什么是很重要的。如果产生了队列阻塞，需要评估这些阻塞会持续多久就会导致系统错误。</li>\n<li>故障过后，确保能找到正确的方法来应对下一次同样的出现。我们建议你从架构上恢复策略而避免各种竞态条件。</li>\n</ul>\n<h3 id=\"灾难恢复与业务持续性\"><a href=\"#灾难恢复与业务持续性\" class=\"headerlink\" title=\"灾难恢复与业务持续性\"></a>灾难恢复与业务持续性</h3><p>​    更加偏移的存储策略能让公有云找到合适的备份策略。</p>\n<h3 id=\"迁移场景\"><a href=\"#迁移场景\" class=\"headerlink\" title=\"迁移场景\"></a>迁移场景</h3><p>​    混合云架构能让应用在不同云平台间迁移。</p>\n<h3 id=\"厂商可用性或实现细节\"><a href=\"#厂商可用性或实现细节\" class=\"headerlink\" title=\"厂商可用性或实现细节\"></a>厂商可用性或实现细节</h3><p>​    业务变更能影响厂商的可用性。比如，服务变更就可能中断一个混合云的环境或者增加成本。</p>\n<h3 id=\"厂商-API-变更\"><a href=\"#厂商-API-变更\" class=\"headerlink\" title=\"厂商 API 变更\"></a>厂商 API 变更</h3><p>​    依赖外部云厂商服务，难以控制厂商不去变更 API，变更可能会破坏兼容性。尽量使用通用的 API 来尽可能减少潜在的冲突。</p>\n<h3 id=\"镜像插拔\"><a href=\"#镜像插拔\" class=\"headerlink\" title=\"镜像插拔\"></a>镜像插拔</h3><p>​    就像 Kilo 版本发布一样，没有一个通用镜像格式适用于所有的云平台。在不同云平台间迁移，需要提前协商好镜像格式。为了简化部署，使用最小化和最简单的镜像，只安装那些必需的组件，使用部署管理器（如 Chef、Puppet）。别为了加速处理而使用笨重的镜像，除非你是在同一云平台上部署这些镜像。</p>\n<h3 id=\"API-差异\"><a href=\"#API-差异\" class=\"headerlink\" title=\"API 差异\"></a>API 差异</h3><p>​    避免使用不仅仅只是 OpenStack 或者带有不同版本 OpenStack 的混合云平台，就像 API 变更一样会带来兼容性问题。</p>\n<h3 id=\"业务或技术多样性\"><a href=\"#业务或技术多样性\" class=\"headerlink\" title=\"业务或技术多样性\"></a>业务或技术多样性</h3><p>​    许多组织根据业务多样性，使用多厂商的混合云平台方案来分摊这些工作负载。这能保证应用的主机资源不被厂商锁定。</p>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cl1sruq6y0003qlvh136x4izu","tag_id":"cl1sruq750007qlvhedhtfmqq","_id":"cl23829jr0000udvhdarxhjow"},{"post_id":"cl1sruq6y0003qlvh136x4izu","tag_id":"cl1sruq75000aqlvhd9490xua","_id":"cl23829js0001udvh75wpafe8"},{"post_id":"cl1sruq6y0003qlvh136x4izu","tag_id":"cl1sruq76000cqlvh476l6utb","_id":"cl23829js0002udvhfezwc5y1"},{"post_id":"cl1sruq6q0001qlvh14khfkwr","tag_id":"cl1sruq710004qlvhh8lmhnmc","_id":"cl23841wo0000yhvh76m35332"},{"post_id":"cl1sruq6q0001qlvh14khfkwr","tag_id":"cl1sruq730005qlvhcxvog7sa","_id":"cl23841wp0001yhvhbx8w8oq2"},{"post_id":"cl1sruq6q0001qlvh14khfkwr","tag_id":"cl1sruq740006qlvh6z0vc0rl","_id":"cl23841wp0002yhvh1zsc775q"},{"post_id":"cl236bssl0000tcvh5px1ehgu","tag_id":"cl236bssr0001tcvh2fbgeae6","_id":"cl23841wp0003yhvhbs4o1vhp"},{"post_id":"cl236bssl0000tcvh5px1ehgu","tag_id":"cl236bssu0002tcvh8r2a332g","_id":"cl23841wp0004yhvh0v6g7yr9"},{"post_id":"cl1t3vblg0000xjvhhula3lu3","tag_id":"cl1t3vblq0001xjvhfap30pa2","_id":"cl23851t000000tvh4prg9uw1"}],"Tag":[{"name":"lua","_id":"cl1sruq710004qlvhh8lmhnmc"},{"name":"webp","_id":"cl1sruq730005qlvhcxvog7sa"},{"name":"imagemagick","_id":"cl1sruq740006qlvh6z0vc0rl"},{"name":"nginx","_id":"cl1sruq750007qlvhedhtfmqq"},{"name":"http2","_id":"cl1sruq75000aqlvhd9490xua"},{"name":"grpc","_id":"cl1sruq76000cqlvh476l6utb"},{"name":"journal","_id":"cl1t3vblq0001xjvhfap30pa2"},{"name":"openstack","_id":"cl236bssr0001tcvh2fbgeae6"},{"name":"arch","_id":"cl236bssu0002tcvh8r2a332g"}]}}